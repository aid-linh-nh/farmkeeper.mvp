<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FARMKEEPER - Đánh giá Độ phức tạp Vườn</title>

    <!-- Google Fonts: Noto Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      /* Sử dụng font Noto Sans cho toàn bộ trang */
      body {
        font-family: 'Noto Sans', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      /* Style cơ bản cho input, đã cập nhật cho nền sáng */
      .input-base {
        background-color: #ffffff; /* white */
        border: 1px solid #d1d5db; /* gray-300 */
        color: #111827; /* gray-900 */
        transition: all 0.2s ease-in-out;
      }
      .input-base:focus {
        --tw-ring-color: #3b82f6; /* blue-500 */
        border-color: #3b82f6;
        outline: 2px solid transparent;
        outline-offset: 2px;
      }
      /* Style cho các link trong sidebar */
      .sidebar-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.25rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease, color 0.2s ease;
        font-weight: 500;
      }
      .sidebar-link:hover {
        background-color: #f3f4f6; /* gray-100 */
      }
      /* Style cho link đang được chọn (active) */
      .sidebar-link.active {
        background-color: #69bd70;
        color: white;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="flex h-screen">
      <!-- Sidebar (Thanh menu bên trái) -->
      <aside
        class="w-64 bg-white text-gray-800 flex flex-col border-r border-gray-200 flex-shrink-0"
      >
        <!-- Logo -->
        <div
          class="h-20 flex items-center justify-center border-b border-gray-200"
        >
          <h1 class="text-2xl font-bold" style="color: #69bd70">FARMKEEPER</h1>
        </div>
        <!-- Navigation -->
        <nav class="flex-1 px-4 py-6">
          <ul class="space-y-4">
            <li>
              <span class="px-4 text-sm font-semibold text-gray-500 uppercase"
                >Menu</span
              >
            </li>
            <!-- Mục cha: Quản lý kỹ thuật -->
            <li>
              <div class="space-y-2">
                <a href="#" class="sidebar-link text-gray-600">
                  <i data-lucide="leaf" class="w-5 h-5 mr-3"></i>
                  <span>Quản lý kỹ thuật</span>
                </a>
                <!-- Danh sách mục con -->
                <ul class="pl-8 space-y-1">
                  <li>
                    <!-- Mục con active -->
                    <a href="#" class="sidebar-link active">
                      <span>Quản lý các hệ số</span>
                    </a>
                  </li>
                  <li>
                    <a
                      href="#"
                      class="sidebar-link text-gray-600 hover:text-gray-900"
                    >
                      <span>Phân công Kỹ sư</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <a
                href="#"
                class="sidebar-link text-gray-600 hover:text-gray-900"
              >
                <i data-lucide="users" class="w-5 h-5 mr-3"></i>
                <span>Quản lý Vườn</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                class="sidebar-link text-gray-600 hover:text-gray-900"
              >
                <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3"></i>
                <span>Báo cáo</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content (Nội dung chính đã chuyển sang nền sáng) -->
      <main class="flex-1 bg-gray-100 text-gray-800 p-6 lg:p-8 overflow-y-auto">
        <div class="max-w-6xl mx-auto">
          <!-- Header -->
          <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">
              Đánh giá Độ phức tạp Vườn
            </h1>
            <p class="text-gray-600 mt-1">
              Lượng hóa độ khó của một vườn dựa trên các đặc tính và quy tắc đã
              thiết lập trước khi phân công.
            </p>
          </div>

          <!-- Main Content Body -->
          <div class="bg-white p-8 rounded-xl border border-gray-200">
            <!-- Farm Selection -->
            <div class="mb-8">
              <label
                for="farm-select"
                class="block text-sm font-medium text-gray-700 mb-2"
                >Chọn Vườn cần Đánh giá</label
              >
              <select
                id="farm-select"
                class="w-full md:w-1/2 rounded-md px-3 py-2 input-base"
              >
                <option>
                  FARM_DL_026 - Vườn sầu riêng ông Tám (Chưa đánh giá)
                </option>
                <option>FARM_DL_027 - Vườn bơ chú Sáu (Chưa đánh giá)</option>
              </select>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <!-- Left Column: Reference Information -->
              <div>
                <h2 class="text-xl font-semibold text-gray-900 mb-4">
                  1. Thông tin Tham chiếu (Từ Hồ sơ Vườn)
                </h2>
                <div
                  class="space-y-4 bg-gray-50 p-6 rounded-lg border border-gray-200"
                >
                  <div>
                    <p class="text-xs text-gray-500">Tên Vườn / Chủ Vườn</p>
                    <p class="font-semibold text-gray-900">
                      Vườn sầu riêng ông Tám
                    </p>
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <p class="text-xs text-gray-500">Diện tích (ha)</p>
                      <p class="font-semibold text-gray-900">6.2</p>
                    </div>
                    <div>
                      <p class="text-xs text-gray-500">Tổng số cây</p>
                      <p class="font-semibold text-gray-900">500</p>
                    </div>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500">Phân bổ Giai đoạn</p>
                    <p class="font-semibold text-gray-900 text-sm">
                      Kinh doanh ổn định (425), Kiến thiết (50), Vườn già (25)
                    </p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500">Khoảng cách từ Trụ sở</p>
                    <p class="font-semibold text-gray-900">25 km</p>
                  </div>
                </div>
              </div>

              <!-- Right Column: Complexity Configuration -->
              <div>
                <h2 class="text-xl font-semibold text-gray-900 mb-4">
                  2. Đánh giá & Cấu hình
                </h2>
                <div class="space-y-6">
                  <!-- Auto-calculated Factors -->
                  <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p class="text-sm font-semibold text-gray-500 mb-3">
                      Hệ số được tính tự động
                    </p>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span>Hệ số Quy mô Diện tích:</span
                        ><span
                          id="auto-factor-area"
                          class="font-bold text-gray-900"
                          >1.20</span
                        >
                      </div>
                      <div class="flex justify-between">
                        <span>Hệ số Giai đoạn (hỗn hợp):</span
                        ><span
                          id="auto-factor-stage"
                          class="font-bold text-gray-900"
                          >1.03</span
                        >
                      </div>
                      <div class="flex justify-between">
                        <span>Hệ số Khoảng cách:</span
                        ><span
                          id="auto-factor-distance"
                          class="font-bold text-gray-900"
                          >1.05</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Manager-evaluated Factors -->
                  <div id="manager-factors-container" class="space-y-4">
                    <p class="text-sm font-semibold text-gray-500">
                      Hệ số do Quản lý đánh giá
                    </p>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Hệ số Mức độ Đầu tư</label
                      >
                      <select
                        class="factor-input w-full rounded-md px-3 py-2 input-base"
                        data-factor-name="investment"
                      >
                        <option value="0.9">Đầu tư cao</option>
                        <option value="1.0" selected>Đầu tư khá</option>
                        <option value="1.1">Đầu tư cầm chừng</option>
                      </select>
                    </div>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Hệ số Mức độ Yêu cầu Hỗ trợ</label
                      >
                      <select
                        class="factor-input w-full rounded-md px-3 py-2 input-base"
                        data-factor-name="support_demand"
                      >
                        <option value="0.95">Thấp (Tự chủ cao)</option>
                        <option value="1.0" selected>Trung bình</option>
                        <option value="1.1">Cao (Yêu cầu thường xuyên)</option>
                      </select>
                    </div>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Hệ số Loại Hợp đồng</label
                      >
                      <select
                        class="factor-input w-full rounded-md px-3 py-2 input-base"
                        data-factor-name="contract_type"
                      >
                        <option value="1.1">
                          Hợp đồng Liên kết - Bao tiêu
                        </option>
                        <option value="1.0" selected>
                          Hợp đồng Hỗ trợ Kỹ thuật
                        </option>
                      </select>
                    </div>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Hệ số Tiềm năng Doanh số</label
                      >
                      <select
                        class="factor-input w-full rounded-md px-3 py-2 input-base"
                        data-factor-name="sales_potential"
                      >
                        <option value="1.15">Tiềm năng rất cao</option>
                        <option value="1.05" selected>Tiềm năng cao</option>
                        <option value="1.0">Tiềm năng trung bình</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- Final Calculation -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                  <div
                    class="bg-gray-50 p-4 rounded-lg border border-gray-200 flex items-center justify-between"
                  >
                    <p class="font-semibold text-gray-900">
                      Hệ số Phức tạp của Vườn
                    </p>
                    <p
                      id="complexity-factor"
                      class="text-3xl font-bold text-yellow-500"
                    >
                      1.35
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 pt-6 border-t border-gray-200 flex justify-end">
              <button
                type="submit"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg flex items-center shadow-lg shadow-green-600/20 transition-transform transform hover:scale-105"
              >
                <i data-lucide="check-check" class="w-5 h-5 mr-2"></i>
                Lưu Đánh giá & Sẵn sàng Phân công
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Khởi tạo icons
      lucide.createIcons();

      // --- DỮ LIỆU MẪU & QUY TẮC ---
      const farmData = {
        area: 6.2,
        distance: 25,
        stageDistribution: {
          stable: 425,
          new: 50,
          old: 25,
          total: 500,
        },
      };

      const RULES = {
        area: [
          { condition: (val) => val >= 10, factor: 1.3 },
          { condition: (val) => val >= 5, factor: 1.2 },
          { condition: (val) => val >= 2, factor: 1.1 },
          { condition: (val) => val < 2, factor: 1.0 },
        ],
        distance: [
          { condition: (val) => val > 50, factor: 1.1 },
          { condition: (val) => val >= 20, factor: 1.05 },
          { condition: (val) => val < 20, factor: 1.0 },
        ],
        stage: {
          new: 1.2,
          stable: 1.0,
          old: 1.1,
        },
      };

      // --- CÁC THÀNH PHẦN DOM ---
      const complexityFactorDisplay =
        document.getElementById('complexity-factor');
      const autoFactorArea = document.getElementById('auto-factor-area');
      const autoFactorStage = document.getElementById('auto-factor-stage');
      const autoFactorDistance = document.getElementById(
        'auto-factor-distance'
      );
      const managerFactorsContainer = document.getElementById(
        'manager-factors-container'
      );

      // --- CÁC HÀM TÍNH TOÁN ---
      function getFactorByRule(value, ruleSet) {
        const rule = ruleSet.find((r) => r.condition(value));
        return rule ? rule.factor : 1.0;
      }

      function calculateComplexity() {
        // 1. Các hệ số tự động
        const areaFactor = getFactorByRule(farmData.area, RULES.area);
        const distanceFactor = getFactorByRule(
          farmData.distance,
          RULES.distance
        );

        const stageDistribution = farmData.stageDistribution;
        const stageFactor =
          (stageDistribution.stable / stageDistribution.total) *
            RULES.stage.stable +
          (stageDistribution.new / stageDistribution.total) * RULES.stage.new +
          (stageDistribution.old / stageDistribution.total) * RULES.stage.old;

        autoFactorArea.textContent = areaFactor.toFixed(2);
        autoFactorStage.textContent = stageFactor.toFixed(3);
        autoFactorDistance.textContent = distanceFactor.toFixed(2);

        let totalFactor = areaFactor * stageFactor * distanceFactor;

        // 2. Các hệ số do quản lý đánh giá
        const managerInputs =
          managerFactorsContainer.querySelectorAll('.factor-input');
        managerInputs.forEach((input) => {
          totalFactor *= parseFloat(input.value);
        });

        // 3. Hiển thị kết quả (cập nhật màu cho nền sáng)
        complexityFactorDisplay.textContent = totalFactor.toFixed(2);
        complexityFactorDisplay.className = `text-3xl font-bold ${
          totalFactor >= 1.5
            ? 'text-red-500'
            : totalFactor >= 1.1
            ? 'text-yellow-500'
            : 'text-green-600'
        }`;
      }

      // --- EVENT LISTENERS ---
      document.querySelectorAll('.factor-input').forEach((input) => {
        input.addEventListener('change', calculateComplexity);
      });

      // Tính toán lần đầu khi tải trang
      calculateComplexity();
    </script>
  </body>
</html>
