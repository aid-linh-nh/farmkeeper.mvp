<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª±c hi·ªán c√¥ng vi·ªác - Phun thu·ªëc s√¢u ph·ªß qu·∫£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .mobile-container {
            max-width: 390px;
            margin: 0 auto;
            background: #f8fafc;
            min-height: 100vh;
            position: relative;
            border: 1px solid #e2e8f0;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .status-bar {
            height: 24px;
            background: #000;
            color: white;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
        }
        
        .task-header {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 16px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }
        
        .step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .step-line {
            position: absolute;
            top: 16px;
            left: 50%;
            width: 100%;
            height: 2px;
            z-index: -1;
        }
        
        .step.completed .step-circle {
            background: #10b981;
            color: white;
        }
        
        .step.active .step-circle {
            background: #3b82f6;
            color: white;
        }
        
        .step.pending .step-circle {
            background: #e5e7eb;
            color: #6b7280;
        }
        
        .step.completed .step-line {
            background: #10b981;
        }
        
        .step.active .step-line {
            background: linear-gradient(to right, #10b981 50%, #e5e7eb 50%);
        }
        
        .step.pending .step-line {
            background: #e5e7eb;
        }
        
        .content-card {
            background: white;
            margin: 8px 16px;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .warning-card {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            margin: 8px 16px;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .safety-card {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
            border-left: 4px solid #ef4444;
            margin: 8px 16px;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .tech-advice-card {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-left: 4px solid #3b82f6;
            margin: 8px 16px;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(to right, #10b981, #059669);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .camera-preview {
            width: 100%;
            height: 200px;
            background: #f3f4f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #d1d5db;
            position: relative;
            overflow: hidden;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .checklist-item.completed {
            background: #ecfdf5;
            border-color: #10b981;
        }
        
        .checklist-item input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            accent-color: #10b981;
        }
        
        .sync-indicator {
            position: fixed;
            top: 50px;
            right: 16px;
            background: white;
            border-radius: 20px;
            padding: 8px 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 12px;
            z-index: 90;
        }
        
        .sync-indicator.syncing {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        .sync-indicator.synced {
            background: #ecfdf5;
            color: #10b981;
        }
        
        .sync-indicator.error {
            background: #fef2f2;
            color: #ef4444;
        }
        
        .floating-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 100;
        }
        
        .fab-primary {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .fab-secondary {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .location-tag {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .timer-display {
            background: linear-gradient(135deg, #1f2937, #374151);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .measurement-input {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .measurement-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .measurement-input .unit {
            background: #f3f4f6;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            color: #6b7280;
            min-width: 60px;
            text-align: center;
        }
        
        .animated-icon {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .hidden {
            display: none;
        }
        
        .step-content {
            padding-bottom: 100px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <span>10:35</span>
            <span>üì∂ üì∂ üì∂ üíæ üîã</span>
        </div>
        
        <!-- Task Header -->
        <div class="task-header">
            <div class="flex items-center justify-between mb-3">
                <button onclick="goBack()" class="text-white">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <div class="text-center flex-1">
                    <h1 class="text-lg font-bold">Phun thu·ªëc s√¢u ph·ªß qu·∫£</h1>
                    <p class="text-sm opacity-90">Khu A3, B1 ‚Ä¢ 35 c√¢y b·ªã ·∫£nh h∆∞·ªüng</p>
                </div>
                <button onclick="callTechnician()" class="text-white">
                    <i class="fas fa-phone text-lg"></i>
                </button>
            </div>
            <div class="flex items-center justify-between text-sm">
                <div class="flex items-center space-x-2">
                    <span class="location-tag">
                        <i class="fas fa-map-marker-alt"></i>
                        Khu A3
                    </span>
                    <span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs">Kh·∫©n c·∫•p</span>
                </div>
                <div class="text-right">
                    <div class="text-xs opacity-90">Th·ªùi gian c√≤n l·∫°i</div>
                    <div class="font-bold text-lg" id="countdown">18:42:15</div>
                </div>
            </div>
        </div>

        <!-- Sync Indicator -->
        <div class="sync-indicator synced" id="syncIndicator">
            <i class="fas fa-cloud-upload-alt mr-1"></i>
            <span>ƒê√£ ƒë·ªìng b·ªô</span>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step completed">
                <div class="step-circle">1</div>
                <span class="text-xs font-medium">Chu·∫©n b·ªã</span>
                <div class="step-line"></div>
            </div>
            <div class="step active">
                <div class="step-circle">2</div>
                <span class="text-xs font-medium">Th·ª±c hi·ªán</span>
                <div class="step-line"></div>
            </div>
            <div class="step pending">
                <div class="step-circle">3</div>
                <span class="text-xs font-medium">B√°o c√°o</span>
                <div class="step-line"></div>
            </div>
            <div class="step pending">
                <div class="step-circle">4</div>
                <span class="text-xs font-medium">X√°c nh·∫≠n</span>
            </div>
        </div>

        <!-- Content Area -->
        <div class="step-content">
            <!-- Step 1: Preparation (Hidden, completed) -->
            <div id="step1" class="hidden">
                <!-- Preparation content would be here -->
            </div>

            <!-- Step 2: Execution (Current active step) -->
            <div id="step2" class="slide-up">
                <!-- Technician Advice -->
                <div class="tech-advice-card">
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user-tie text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-blue-800 mb-2">H∆∞·ªõng d·∫´n t·ª´ KS. Ph·∫°m VƒÉn Minh</h4>
                            <div class="bg-white rounded-lg p-3 border border-blue-200">
                                <p class="text-sm text-gray-700 mb-2"><strong>C√¥ng th·ª©c:</strong> Imidacloprid 200SC - 1.5ml/L n∆∞·ªõc</p>
                                <p class="text-sm text-gray-700 mb-2"><strong>Th·ªùi gian:</strong> Phun bu·ªïi chi·ªÅu (15:00-17:00), tr√°nh n·∫Øng g·∫Øt</p>
                                <p class="text-sm text-gray-700 mb-2"><strong>K·ªπ thu·∫≠t:</strong> Phun ƒë·ªÅu t√°n l√°, t·∫≠p trung v√†o qu·∫£ non</p>
                                <p class="text-sm text-red-600"><strong>L∆∞u √Ω:</strong> M·∫∑c ƒë·ªì b·∫£o h·ªô ƒë·∫ßy ƒë·ªß, kh√¥ng ƒÉn u·ªëng khi phun</p>
                            </div>
                            <div class="flex items-center space-x-2 mt-2">
                                <button onclick="playAudioGuide()" class="bg-blue-500 text-white px-3 py-1 rounded-full text-xs">
                                    <i class="fas fa-play mr-1"></i>Nghe h∆∞·ªõng d·∫´n
                                </button>
                                <button onclick="askQuestion()" class="bg-gray-500 text-white px-3 py-1 rounded-full text-xs">
                                    <i class="fas fa-question mr-1"></i>H·ªèi th√™m
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Safety Checklist -->
                <div class="safety-card">
                    <h4 class="font-bold text-red-800 mb-3 flex items-center">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Ki·ªÉm tra an to√†n b·∫Øt bu·ªôc
                    </h4>
                    <div class="space-y-3">
                        <label class="checklist-item completed">
                            <input type="checkbox" checked disabled>
                            <span class="text-sm">M·∫∑c qu·∫ßn √°o d√†i tay, ƒë·ªì b·∫£o h·ªô</span>
                        </label>
                        <label class="checklist-item completed">
                            <input type="checkbox" checked disabled>
                            <span class="text-sm">ƒêeo kh·∫©u trang, k√≠nh b·∫£o v·ªá</span>
                        </label>
                        <label class="checklist-item completed">
                            <input type="checkbox" checked disabled>
                            <span class="text-sm">Ki·ªÉm tra thi·∫øt b·ªã phun</span>
                        </label>
                        <label class="checklist-item completed">
                            <input type="checkbox" checked disabled>
                            <span class="text-sm">Chu·∫©n b·ªã thu·ªëc ƒë√∫ng li·ªÅu l∆∞·ª£ng</span>
                        </label>
                    </div>
                </div>

                <!-- Weather Conditions -->
                <div class="warning-card">
                    <h4 class="font-bold text-yellow-800 mb-2 flex items-center">
                        <i class="fas fa-cloud-sun mr-2"></i>
                        ƒêi·ªÅu ki·ªán th·ªùi ti·∫øt hi·ªán t·∫°i
                    </h4>
                    <div class="grid grid-cols-3 gap-3 mb-3">
                        <div class="bg-white rounded-lg p-2 text-center">
                            <div class="text-lg font-bold text-orange-600">32¬∞C</div>
                            <div class="text-xs text-gray-600">Nhi·ªát ƒë·ªô</div>
                        </div>
                        <div class="bg-white rounded-lg p-2 text-center">
                            <div class="text-lg font-bold text-blue-600">65%</div>
                            <div class="text-xs text-gray-600">ƒê·ªô ·∫©m</div>
                        </div>
                        <div class="bg-white rounded-lg p-2 text-center">
                            <div class="text-lg font-bold text-green-600">2 km/h</div>
                            <div class="text-xs text-gray-600">Gi√≥</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 text-center">
                        <span class="text-sm text-green-700 font-medium">
                            <i class="fas fa-check-circle mr-1"></i>
                            ƒêi·ªÅu ki·ªán phun thu·ªëc t·ªët
                        </span>
                    </div>
                </div>

                <!-- Execution Progress -->
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-tasks mr-2"></i>
                        Ti·∫øn ƒë·ªô th·ª±c hi·ªán
                    </h4>
                    
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium">Khu A3 (18 c√¢y)</span>
                            <span class="text-sm text-blue-600 font-bold" id="progressA3">12/18 c√¢y</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 67%" id="progressBarA3"></div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium">Khu B1 (17 c√¢y)</span>
                            <span class="text-sm text-gray-600" id="progressB1">0/17 c√¢y</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" id="progressBarB1"></div>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium text-blue-800">T·ªïng ti·∫øn ƒë·ªô:</span>
                            <span class="font-bold text-blue-800" id="totalProgress">34%</span>
                        </div>
                        <div class="text-sm text-blue-700">
                            Th·ªùi gian ƒë√£ s·ª≠ d·ª•ng: <span class="font-medium" id="timeSpent">1h 25m</span>
                        </div>
                        <div class="text-sm text-blue-700">
                            Th·ªùi gian c√≤n l·∫°i d·ª± ki·∫øn: <span class="font-medium" id="timeRemaining">2h 35m</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3">H√†nh ƒë·ªông nhanh</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="markTreeCompleted()" class="bg-green-500 text-white py-3 rounded-lg font-medium flex items-center justify-center">
                            <i class="fas fa-check mr-2"></i>
                            Ho√†n th√†nh c√¢y
                        </button>
                        <button onclick="reportIssue()" class="bg-yellow-500 text-white py-3 rounded-lg font-medium flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            B√°o v·∫•n ƒë·ªÅ
                        </button>
                        <button onclick="takePhoto()" class="bg-blue-500 text-white py-3 rounded-lg font-medium flex items-center justify-center">
                            <i class="fas fa-camera mr-2"></i>
                            Ch·ª•p ·∫£nh
                        </button>
                        <button onclick="pauseWork()" class="bg-gray-500 text-white py-3 rounded-lg font-medium flex items-center justify-center">
                            <i class="fas fa-pause mr-2"></i>
                            T·∫°m d·ª´ng
                        </button>
                    </div>
                </div>

                <!-- Material Usage Tracking -->
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-flask mr-2"></i>
                        S·ª≠ d·ª•ng v·∫≠t t∆∞
                    </h4>
                    
                    <div class="space-y-3">
                        <div class="measurement-input">
                            <label class="text-sm font-medium text-gray-700 min-w-[120px]">Imidacloprid 200SC:</label>
                            <input type="number" placeholder="1.5" value="18" id="pesticide-used" onchange="updateMaterialUsage()">
                            <span class="unit">ml</span>
                        </div>
                        
                        <div class="measurement-input">
                            <label class="text-sm font-medium text-gray-700 min-w-[120px]">N∆∞·ªõc:</label>
                            <input type="number" placeholder="12" value="12" id="water-used" onchange="updateMaterialUsage()">
                            <span class="unit">l√≠t</span>
                        </div>
                        
                        <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
                            <h5 class="font-semibold text-yellow-800 mb-1">D·ª± ki·∫øn c·∫ßn d√πng:</h5>
                            <p class="text-sm text-yellow-700">‚Ä¢ Imidacloprid: 52.5ml (35 c√¢y √ó 1.5ml)</p>
                            <p class="text-sm text-yellow-700">‚Ä¢ N∆∞·ªõc: 35 l√≠t (35 c√¢y √ó 1L)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Reporting (Hidden) -->
            <div id="step3" class="hidden">
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-camera mr-2"></i>
                        Ch·ª•p ·∫£nh b√°o c√°o
                    </h4>
                    
                    <div class="camera-preview" onclick="openCamera()">
                        <div class="text-center">
                            <i class="fas fa-camera text-4xl text-gray-400 mb-2 animated-icon"></i>
                            <p class="text-sm text-gray-600">Nh·∫•n ƒë·ªÉ ch·ª•p ·∫£nh</p>
                            <p class="text-xs text-gray-500">Ch·ª•p: Tr∆∞·ªõc khi phun, ƒëang phun, sau khi phun</p>
                        </div>
                    </div>
                    
                    <div class="photo-grid" id="photoGrid">
                        <!-- Photos will be added here -->
                    </div>
                </div>

                <!-- Report Form -->
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-clipboard-list mr-2"></i>
                        B√°o c√°o chi ti·∫øt
                    </h4>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">T√¨nh tr·∫°ng s√¢u b·ªánh</label>
                            <select class="w-full p-3 border border-gray-300 rounded-lg">
                                <option>Nghi√™m tr·ªçng - Nhi·ªÅu qu·∫£ b·ªã ·∫£nh h∆∞·ªüng</option>
                                <option>Trung b√¨nh - M·ªôt s·ªë qu·∫£ b·ªã h·∫°i</option>
                                <option>Nh·∫π - √çt qu·∫£ b·ªã ·∫£nh h∆∞·ªüng</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hi·ªáu qu·∫£ phun thu·ªëc</label>
                            <select class="w-full p-3 border border-gray-300 rounded-lg">
                                <option>Phun ƒë·ªÅu, ƒë·∫ßy ƒë·ªß theo h∆∞·ªõng d·∫´n</option>
                                <option>Phun t·ªët, m·ªôt s·ªë ch·ªó ch∆∞a ƒë·ªÅu</option>
                                <option>G·∫∑p kh√≥ khƒÉn, c·∫ßn h·ªó tr·ª£ th√™m</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ghi ch√∫ th√™m</label>
                            <textarea rows="3" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="M√¥ t·∫£ chi ti·∫øt qu√° tr√¨nh th·ª±c hi·ªán, v·∫•n ƒë·ªÅ g·∫∑p ph·∫£i (n·∫øu c√≥)..."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Th·ªùi ti·∫øt khi phun</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="text" placeholder="Nhi·ªát ƒë·ªô" value="32¬∞C" class="p-2 border border-gray-300 rounded">
                                <input type="text" placeholder="ƒê·ªô ·∫©m" value="65%" class="p-2 border border-gray-300 rounded">
                                <input type="text" placeholder="Gi√≥" value="2 km/h" class="p-2 border border-gray-300 rounded">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Material Used Summary -->
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-boxes mr-2"></i>
                        V·∫≠t t∆∞ ƒë√£ s·ª≠ d·ª•ng
                    </h4>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">Imidacloprid 200SC</span>
                            <span class="font-bold text-blue-600">52.5 ml</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">N∆∞·ªõc</span>
                            <span class="font-bold text-blue-600">35 l√≠t</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200">
                            <span class="font-medium text-green-800">Chi ph√≠ v·∫≠t t∆∞</span>
                            <span class="font-bold text-green-600">126,000 VNƒê</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmation (Hidden) -->
            <div id="step4" class="hidden">
                <div class="content-card">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-user-check mr-2"></i>
                        Ch·ªù x√°c nh·∫≠n t·ª´ k·ªπ thu·∫≠t vi√™n
                    </h4>
                    
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-clock text-blue-600 text-2xl animated-icon"></i>
                        </div>
                        <h5 class="font-bold text-gray-800 mb-2">ƒêang g·ª≠i b√°o c√°o...</h5>
                        <p class="text-sm text-gray-600 mb-4">KS. Ph·∫°m VƒÉn Minh s·∫Ω xem x√©t v√† ph·∫£n h·ªìi trong 30 ph√∫t</p>
                        
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <p class="text-sm text-blue-700 mb-2">B√°o c√°o ƒë√£ g·ª≠i th√†nh c√¥ng!</p>
                            <p class="text-xs text-blue-600">Bao g·ªìm: 6 ·∫£nh, b√°o c√°o chi ti·∫øt, s·ª≠ d·ª•ng v·∫≠t t∆∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timer Display (Floating) -->
        <div class="timer-display" id="timerDisplay">
            <div class="text-2xl font-bold" id="workTimer">01:25:32</div>
            <div class="text-sm opacity-75">Th·ªùi gian l√†m vi·ªác</div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="floating-controls">
            <button class="fab-secondary" onclick="contactTechnician()" title="Li√™n h·ªá k·ªπ thu·∫≠t vi√™n">
                <i class="fas fa-headset"></i>
            </button>
            <button class="fab-primary" onclick="nextStep()" id="nextStepBtn">
                <i class="fas fa-arrow-right"></i>
            </button>
            <button class="fab-secondary" onclick="emergencyStop()" title="D·ª´ng kh·∫©n c·∫•p">
                <i class="fas fa-stop"></i>
            </button>
        </div>
    </div>

    <script>
        let currentStep = 2; // Starting at execution step
        let workStartTime = Date.now() - (1 * 60 * 60 * 1000 + 25 * 60 * 1000 + 32 * 1000); // 1h 25m 32s ago
        let completedTrees = 12;
        let totalTrees = 35;
        let photos = [];
        let syncStatus = 'synced';

        // Timer functions
        function updateTimers() {
            const now = Date.now();
            const workDuration = now - workStartTime;
            
            // Update work timer
            const hours = Math.floor(workDuration / (1000 * 60 * 60));
            const minutes = Math.floor((workDuration % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((workDuration % (1000 * 60)) / 1000);
            
            document.getElementById('workTimer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update countdown (24 hours from task start)
            const deadline = workStartTime + (24 * 60 * 60 * 1000);
            const remaining = deadline - now;
            
            if (remaining > 0) {
                const rHours = Math.floor(remaining / (1000 * 60 * 60));
                const rMinutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const rSeconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `${rHours.toString().padStart(2, '0')}:${rMinutes.toString().padStart(2, '0')}:${rSeconds.toString().padStart(2, '0')}`;
            }
        }

        // Progress tracking
        function markTreeCompleted() {
            if (completedTrees < totalTrees) {
                completedTrees++;
                updateProgress();
                syncData();
                showNotification('ƒê√£ ho√†n th√†nh 1 c√¢y', 'success');
            }
        }

        function updateProgress() {
            const progressA3 = Math.min(completedTrees, 18);
            const progressB1 = Math.max(0, completedTrees - 18);
            
            // Update display
            document.getElementById('progressA3').textContent = `${progressA3}/18 c√¢y`;
            document.getElementById('progressBarA3').style.width = `${(progressA3 / 18) * 100}%`;
            
            document.getElementById('progressB1').textContent = `${progressB1}/17 c√¢y`;
            document.getElementById('progressBarB1').style.width = `${(progressB1 / 17) * 100}%`;
            
            const totalProgress = Math.round((completedTrees / totalTrees) * 100);
            document.getElementById('totalProgress').textContent = `${totalProgress}%`;
            
            // Update estimated time remaining
            const avgTimePerTree = (Date.now() - workStartTime) / completedTrees;
            const remainingTrees = totalTrees - completedTrees;
            const estimatedRemaining = remainingTrees * avgTimePerTree;
            
            const rHours = Math.floor(estimatedRemaining / (1000 * 60 * 60));
            const rMinutes = Math.floor((estimatedRemaining % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById('timeRemaining').textContent = `${rHours}h ${rMinutes}m`;
        }

        // Material usage tracking
        function updateMaterialUsage() {
            const pesticide = document.getElementById('pesticide-used').value;
            const water = document.getElementById('water-used').value;
            
            syncData();
            showNotification('ƒê√£ c·∫≠p nh·∫≠t s·ª≠ d·ª•ng v·∫≠t t∆∞', 'info');
        }

        // Photo management
        function openCamera() {
            // Simulate camera opening
            showNotification('M·ªü camera...', 'info');
            setTimeout(() => {
                takePhotoSimulation();
            }, 1000);
        }

        function takePhoto() {
            openCamera();
        }

        function takePhotoSimulation() {
            const photoTypes = ['Tr∆∞·ªõc khi phun', 'ƒêang phun thu·ªëc', 'Sau khi phun', 'T√¨nh tr·∫°ng s√¢u b·ªánh', 'Qu·∫£ ƒë√£ x·ª≠ l√Ω'];
            const photoType = photoTypes[photos.length % photoTypes.length];
            
            const photo = {
                id: Date.now(),
                type: photoType,
                timestamp: new Date().toLocaleString('vi-VN'),
                url: `data:image/svg+xml;base64,${btoa(`<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><rect width="200" height="200" fill="#e5e7eb"/><text x="100" y="100" text-anchor="middle" dominant-baseline="middle" fill="#6b7280" font-family="Arial" font-size="12">${photoType}</text></svg>`)}`
            };
            
            photos.push(photo);
            updatePhotoGrid();
            syncData();
            showNotification(`ƒê√£ ch·ª•p ·∫£nh: ${photoType}`, 'success');
        }

        function updatePhotoGrid() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = photos.map(photo => `
                <div class="photo-item">
                    <img src="${photo.url}" alt="${photo.type}">
                    <button class="photo-remove" onclick="removePhoto(${photo.id})">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1">
                        ${photo.type}
                    </div>
                </div>
            `).join('');
        }

        function removePhoto(photoId) {
            photos = photos.filter(p => p.id !== photoId);
            updatePhotoGrid();
            syncData();
        }

        // Step navigation
        function nextStep() {
            if (currentStep < 4) {
                currentStep++;
                updateStepDisplay();
                syncData();
            }
        }

        function updateStepDisplay() {
            // Hide all steps
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    step.classList.add('hidden');
                }
            }
            
            // Show current step
            const currentStepElement = document.getElementById(`step${currentStep}`);
            if (currentStepElement) {
                currentStepElement.classList.remove('hidden');
                currentStepElement.classList.add('slide-up');
            }
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('completed', 'active', 'pending');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.add('pending');
                }
            });
            
            // Update next button
            const nextBtn = document.getElementById('nextStepBtn');
            if (currentStep === 2) {
                nextBtn.innerHTML = '<i class="fas fa-clipboard-list"></i>';
                nextBtn.title = 'Chuy·ªÉn sang b√°o c√°o';
            } else if (currentStep === 3) {
                nextBtn.innerHTML = '<i class="fas fa-check"></i>';
                nextBtn.title = 'Ho√†n th√†nh v√† g·ª≠i b√°o c√°o';
            } else if (currentStep === 4) {
                nextBtn.innerHTML = '<i class="fas fa-home"></i>';
                nextBtn.title = 'V·ªÅ trang ch·ªß';
                nextBtn.onclick = () => goBack();
            }
        }

        // Data synchronization
        function syncData() {
            const syncIndicator = document.getElementById('syncIndicator');
            syncIndicator.className = 'sync-indicator syncing';
            syncIndicator.innerHTML = '<i class="fas fa-sync-alt fa-spin mr-1"></i><span>ƒêang ƒë·ªìng b·ªô...</span>';
            
            // Simulate sync process
            setTimeout(() => {
                syncIndicator.className = 'sync-indicator synced';
                syncIndicator.innerHTML = '<i class="fas fa-cloud-upload-alt mr-1"></i><span>ƒê√£ ƒë·ªìng b·ªô</span>';
            }, 1500);
        }

        // Communication functions
        function callTechnician() {
            showNotification('ƒêang g·ªçi KS. Ph·∫°m VƒÉn Minh...', 'info');
        }

        function contactTechnician() {
            showNotification('M·ªü chat v·ªõi k·ªπ thu·∫≠t vi√™n...', 'info');
        }

        function askQuestion() {
            showNotification('M·ªü form h·ªèi ƒë√°p v·ªõi k·ªπ thu·∫≠t vi√™n...', 'info');
        }

        function playAudioGuide() {
            showNotification('Ph√°t h∆∞·ªõng d·∫´n b·∫±ng gi·ªçng n√≥i...', 'info');
        }

        // Issue reporting
        function reportIssue() {
            const issues = [
                'Thi·∫øt b·ªã phun b·ªã t·∫Øc',
                'Thu·ªëc kh√¥ng ƒë·ªß',
                'Th·ªùi ti·∫øt thay ƒë·ªïi',
                'C√¢y c√≥ v·∫•n ƒë·ªÅ kh√°c',
                'C·∫ßn h·ªó tr·ª£ k·ªπ thu·∫≠t'
            ];
            
            const issue = prompt('Ch·ªçn v·∫•n ƒë·ªÅ:\n' + issues.map((item, i) => `${i + 1}. ${item}`).join('\n'));
            if (issue) {
                showNotification(`ƒê√£ b√°o c√°o: ${issues[parseInt(issue) - 1] || 'V·∫•n ƒë·ªÅ kh√°c'}`, 'warning');
                syncData();
            }
        }

        // Work control
        function pauseWork() {
            showNotification('ƒê√£ t·∫°m d·ª´ng c√¥ng vi·ªác', 'info');
        }

        function emergencyStop() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën d·ª´ng kh·∫©n c·∫•p c√¥ng vi·ªác n√†y?')) {
                showNotification('ƒê√£ d·ª´ng kh·∫©n c·∫•p - Th√¥ng b√°o k·ªπ thu·∫≠t vi√™n', 'error');
            }
        }

        function goBack() {
            if (confirm('B·∫°n c√≥ mu·ªën tho√°t? Ti·∫øn ƒë·ªô s·∫Ω ƒë∆∞·ª£c l∆∞u t·ª± ƒë·ªông.')) {
                showNotification('ƒêang l∆∞u v√† tho√°t...', 'info');
                setTimeout(() => {
                    window.history.back();
                }, 1000);
            }
        }

        // Utility functions
        function showNotification(message, type = 'info') {
            const colors = {
                'info': 'bg-blue-500',
                'success': 'bg-green-500',
                'warning': 'bg-yellow-500',
                'error': 'bg-red-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-20 left-1/2 transform -translate-x-1/2 ${colors[type]} text-white px-4 py-2 rounded-lg text-sm z-50 shadow-lg`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Task Execution App initialized');
            
            // Update timers every second
            setInterval(updateTimers, 1000);
            updateTimers();
            
            // Update progress display
            updateProgress();
            
            // Update step display
            updateStepDisplay();
            
            // Simulate automatic sync every 30 seconds
            setInterval(() => {
                if (Math.random() > 0.8) { // 20% chance
                    syncData();
                }
            }, 30000);
            
            // Initial sync
            setTimeout(() => {
                syncData();
            }, 2000);
        });
    </script>
</body>
</html>