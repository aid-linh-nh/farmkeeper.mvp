<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê√°nh gi√° nhanh C√¥ng vi·ªác - FarmKeeper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .main-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .card-modern {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(226, 232, 240, 0.6);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .section-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            font-size: 1.1rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        
        .quick-metric {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .quick-metric:hover {
            border-color: #22c55e;
            background: #f0fdf4;
        }
        
        .quick-metric.selected {
            border-color: #22c55e;
            background: #f0fdf4;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .star {
            font-size: 2rem;
            color: #d1d5db;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .star.active {
            color: #fbbf24;
            transform: scale(1.1);
        }
        
        .star:hover {
            color: #fbbf24;
            transform: scale(1.2);
        }
        
        .photo-capture {
            border: 3px dashed #22c55e;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            background: #f0fdf4;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }
        
        .photo-capture:hover {
            background: #dcfce7;
            transform: translateY(-2px);
        }
        
        .photo-capture.has-photo {
            border-color: #16a34a;
            background: #dcfce7;
        }
        
        .uploaded-photo {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            margin: 0.5rem;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .uploaded-photo img {
            width: 120px;
            height: 120px;
            object-fit: cover;
        }
        
        .photo-overlay {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .photo-overlay:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }
        
        .status-card {
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .status-completed {
            border-color: #22c55e;
            background: #f0fdf4;
            color: #166534;
        }
        
        .status-partial {
            border-color: #f59e0b;
            background: #fffbeb;
            color: #92400e;
        }
        
        .status-failed {
            border-color: #ef4444;
            background: #fef2f2;
            color: #991b1b;
        }
        
        .quick-input {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .quick-input:focus-within {
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }
        
        .task-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
        }
        
        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#22c55e 0deg, #22c55e 252deg, #e5e7eb 252deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .progress-circle::before {
            content: '';
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            position: absolute;
        }
        
        .progress-text {
            position: relative;
            font-weight: bold;
            color: #1f2937;
        }
        
        .completion-badge {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
        }
        
        .custom-metric {
            position: relative;
        }
        
        .custom-metric .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
        }
        
        .custom-metric:hover .remove-btn {
            opacity: 1;
        }
        
        .custom-metric .remove-btn:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }
        
        .parameter-templates {
            max-height: 200px;
            overflow-y: auto;
        }
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .star {
                font-size: 1.5rem;
            }
            
            .btn-primary {
                position: fixed;
                bottom: 1rem;
                left: 1rem;
                right: 1rem;
                z-index: 50;
                box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
            }
            
            .main-content {
                padding-bottom: 6rem;
            }
        }
    </style>
</head>
<body class="main-container">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- Task Header -->
        <div class="task-header">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-seedling text-2xl mr-3"></i>
                        <div>
                            <h1 class="text-xl font-bold">B√≥n ph√¢n NPK ƒë·ªãnh k·ª≥</h1>
                            <p class="text-sm opacity-90">V∆∞·ªùn A1 - S·∫ßu ri√™ng Dona | 15/01/2024</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 text-sm">
                        <span class="bg-white/20 px-2 py-1 rounded">SR_FERT_001</span>
                        <span class="bg-white/20 px-2 py-1 rounded">120 c√¢y</span>
                        <span class="bg-white/20 px-2 py-1 rounded">Nguy·ªÖn VƒÉn Nam</span>
                    </div>
                </div>
                <div class="progress-circle">
                    <span class="progress-text">70%</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Quick Status -->
            <div class="section-card">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-flag-checkered text-green-600 mr-2"></i>
                    T√¨nh tr·∫°ng ho√†n th√†nh
                </h2>
                
                <div class="grid grid-cols-1 gap-3">
                    <div class="status-card status-completed cursor-pointer" onclick="selectStatus('completed')">
                        <div class="flex items-center">
                            <input type="radio" name="status" value="completed" checked class="mr-3 w-5 h-5">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-xl mr-3"></i>
                                <div>
                                    <div class="font-semibold">Ho√†n th√†nh ƒë·∫ßy ƒë·ªß</div>
                                    <div class="text-sm opacity-75">T·∫•t c·∫£ c√¥ng vi·ªác ƒë√£ th·ª±c hi·ªán theo k·∫ø ho·∫°ch</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-card status-partial cursor-pointer" onclick="selectStatus('partial')">
                        <div class="flex items-center">
                            <input type="radio" name="status" value="partial" class="mr-3 w-5 h-5">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-xl mr-3"></i>
                                <div>
                                    <div class="font-semibold">Ho√†n th√†nh m·ªôt ph·∫ßn</div>
                                    <div class="text-sm opacity-75">M·ªôt s·ªë h·∫°ng m·ª•c ch∆∞a ho√†n th√†nh ho·∫∑c c√≥ v·∫•n ƒë·ªÅ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-card status-failed cursor-pointer" onclick="selectStatus('failed')">
                        <div class="flex items-center">
                            <input type="radio" name="status" value="failed" class="mr-3 w-5 h-5">
                            <div class="flex items-center">
                                <i class="fas fa-times-circle text-xl mr-3"></i>
                                <div>
                                    <div class="font-semibold">Kh√¥ng ho√†n th√†nh</div>
                                    <div class="text-sm opacity-75">C√¥ng vi·ªác b·ªã gi√°n ƒëo·∫°n ho·∫∑c kh√¥ng th·ªÉ th·ª±c hi·ªán</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Metrics -->
            <div class="section-card">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-tachometer-alt text-blue-600 mr-2"></i>
                    K·∫øt qu·∫£ th·ª±c hi·ªán
                </h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="metrics-grid">
                    <div class="quick-metric" onclick="editMetric(this, 'fertilizer', 'kg')">
                        <div class="metric-value" data-target="300">288</div>
                        <div class="metric-label">Ph√¢n s·ª≠ d·ª•ng (kg)</div>
                        <div class="text-xs text-green-600 mt-1">-4% so v·ªõi k·∫ø ho·∫°ch</div>
                    </div>
                    
                    <div class="quick-metric" onclick="editMetric(this, 'time', 'gi·ªù')">
                        <div class="metric-value" data-target="3">3.5</div>
                        <div class="metric-label">Th·ªùi gian (gi·ªù)</div>
                        <div class="text-xs text-orange-600 mt-1">+17% so v·ªõi k·∫ø ho·∫°ch</div>
                    </div>
                    
                    <div class="quick-metric" onclick="editMetric(this, 'trees', 'c√¢y')">
                        <div class="metric-value" data-target="120">120</div>
                        <div class="metric-label">C√¢y x·ª≠ l√Ω</div>
                        <div class="text-xs text-green-600 mt-1">ƒê√∫ng k·∫ø ho·∫°ch</div>
                    </div>
                    
                    <div class="quick-metric" onclick="editMetric(this, 'workers', 'ng∆∞·ªùi')">
                        <div class="metric-value" data-target="2">2</div>
                        <div class="metric-label">Nh√¢n c√¥ng</div>
                        <div class="text-xs text-green-600 mt-1">ƒê√∫ng k·∫ø ho·∫°ch</div>
                    </div>
                </div>
                
                <div class="mt-4 flex items-center justify-between">
                    <div class="p-3 bg-blue-50 rounded-lg flex-1 mr-3">
                        <div class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            Nh·∫•n v√†o c√°c s·ªë li·ªáu ƒë·ªÉ ch·ªânh s·ª≠a n·∫øu c·∫ßn thi·∫øt
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="btn-secondary" onclick="showQuickAddSuggestions()" style="width: auto; white-space: nowrap;">
                            <i class="fas fa-magic mr-2"></i>G·ª£i √Ω
                        </button>
                        <button class="btn-secondary" onclick="showAddParameterModal()" style="width: auto; white-space: nowrap;">
                            <i class="fas fa-plus mr-2"></i>Th√™m tham s·ªë
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quality Rating -->
            <div class="section-card">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-star text-yellow-500 mr-2"></i>
                    ƒê√°nh gi√° ch·∫•t l∆∞·ª£ng
                </h2>
                
                <div class="text-center">
                    <div class="rating-stars" id="quality-rating">
                        <span class="star active" data-rating="1">‚òÖ</span>
                        <span class="star active" data-rating="2">‚òÖ</span>
                        <span class="star active" data-rating="3">‚òÖ</span>
                        <span class="star active" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                    <div class="text-lg font-semibold text-gray-800 mb-2">4/5 - T·ªët</div>
                    <div class="text-sm text-gray-600">Ph√¢n ƒë∆∞·ª£c r·∫£i ƒë·ªÅu, ƒë√∫ng ƒë·ªãnh l∆∞·ª£ng. C√≥ m∆∞a nh·ªè l√†m ch·∫≠m ti·∫øn ƒë·ªô.</div>
                </div>
            </div>

            <!-- Photo Evidence -->
            <div class="section-card">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-camera text-purple-600 mr-2"></i>
                    H√¨nh ·∫£nh minh ch·ª©ng
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2">Tr∆∞·ªõc th·ª±c hi·ªán</h3>
                        <div class="photo-capture" onclick="capturePhoto('before')">
                            <i class="fas fa-camera text-3xl text-green-600 mb-2"></i>
                            <div class="font-medium">Ch·ª•p ·∫£nh</div>
                            <div class="text-sm text-gray-600">T√¨nh tr·∫°ng ban ƒë·∫ßu</div>
                            <input type="file" accept="image/*" capture="camera" style="display: none;" id="before-camera">
                        </div>
                        <div id="before-photos">
                            <div class="uploaded-photo">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik00MCA0NUw2MCA2NUw4MCA0NUw5MCA1NUw5MCA4NUgzMFY1NUw0MCA0NVoiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+" alt="Tr∆∞·ªõc b√≥n ph√¢n">
                                <div class="photo-overlay" onclick="removePhoto(this)">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2">Trong qu√° tr√¨nh</h3>
                        <div class="photo-capture has-photo" onclick="capturePhoto('during')">
                            <i class="fas fa-check-circle text-3xl text-green-600 mb-2"></i>
                            <div class="font-medium">2 ·∫£nh ƒë√£ ch·ª•p</div>
                            <div class="text-sm text-gray-600">Nh·∫•n ƒë·ªÉ th√™m ·∫£nh</div>
                            <input type="file" accept="image/*" capture="camera" style="display: none;" id="during-camera">
                        </div>
                        <div id="during-photos">
                            <div class="uploaded-photo">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRkVGM0M3Ii8+CjxwYXRoIGQ9Ik00MCA0NUw2MCA2NUw4MCA0NUw5MCA1NUw5MCA4NUgzMFY1NUw0MCA0NVoiIGZpbGw9IiNGNTlFMEIiLz4KPC9zdmc+" alt="R·∫£i ph√¢n">
                                <div class="photo-overlay" onclick="removePhoto(this)">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                            <div class="uploaded-photo">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRkVGM0M3Ii8+CjxwYXRoIGQ9Ik00MCA0NUw2MCA2NUw4MCA0NUw5MCA1NUw5MCA4NUgzMFY1NUw0MCA0NVoiIGZpbGw9IiNGNTlFMEIiLz4KPC9zdmc+" alt="X·ªõi ƒë·∫•t">
                                <div class="photo-overlay" onclick="removePhoto(this)">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2">Sau ho√†n th√†nh</h3>
                        <div class="photo-capture" onclick="capturePhoto('after')">
                            <i class="fas fa-camera text-3xl text-green-600 mb-2"></i>
                            <div class="font-medium">Ch·ª•p ·∫£nh</div>
                            <div class="text-sm text-gray-600">K·∫øt qu·∫£ cu·ªëi c√πng</div>
                            <input type="file" accept="image/*" capture="camera" style="display: none;" id="after-camera">
                        </div>
                        <div id="after-photos"></div>
                    </div>
                </div>
            </div>

            <!-- Quick Notes -->
            <div class="section-card">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-comment-alt text-indigo-600 mr-2"></i>
                    Ghi ch√∫ nhanh
                </h2>
                
                <div class="space-y-4">
                    <div class="quick-input">
                        <label class="block text-sm font-medium text-gray-700 mb-2">V·∫•n ƒë·ªÅ g·∫∑p ph·∫£i (n·∫øu c√≥)</label>
                        <textarea class="form-input" rows="2" placeholder="VD: M∆∞a nh·ªè l√†m ch·∫≠m ti·∫øn ƒë·ªô, ƒë·∫•t c·ª©ng m·ªôt s·ªë khu v·ª±c...">M∆∞a nh·ªè xu·∫•t hi·ªán l√†m ph·∫£i t·∫°m d·ª´ng 30 ph√∫t. M·ªôt s·ªë khu v·ª±c ƒë·∫•t c·ª©ng kh√≥ x·ªõi tr·ªôn ph√¢n.</textarea>
                    </div>
                    
                    <div class="quick-input">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ghi ch√∫ th√™m</label>
                        <textarea class="form-input" rows="2" placeholder="VD: C√¢y ph·∫£n ·ª©ng t·ªët, l√° xanh h∆°n sau 2 ng√†y...">Ph√¢n ƒë∆∞·ª£c r·∫£i ƒë·ªÅu v√† ƒë√∫ng ƒë·ªãnh l∆∞·ª£ng. Th·ªùi ti·∫øt t·ªïng th·ªÉ thu·∫≠n l·ª£i.</textarea>
                    </div>
                </div>
            </div>

            <!-- Weather Conditions -->
            <div class="section-card">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-cloud-sun text-blue-600 mr-2"></i>
                    ƒêi·ªÅu ki·ªán th·ª±c hi·ªán
                </h2>
                
                <div class="weather-info">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div>
                            <i class="fas fa-thermometer-half text-2xl mb-2"></i>
                            <div class="font-bold text-lg">28¬∞C</div>
                            <div class="text-sm opacity-90">Nhi·ªát ƒë·ªô</div>
                        </div>
                        <div>
                            <i class="fas fa-tint text-2xl mb-2"></i>
                            <div class="font-bold text-lg">75%</div>
                            <div class="text-sm opacity-90">ƒê·ªô ·∫©m</div>
                        </div>
                        <div>
                            <i class="fas fa-cloud-rain text-2xl mb-2"></i>
                            <div class="font-bold text-lg">2mm</div>
                            <div class="text-sm opacity-90">M∆∞a nh·ªè</div>
                        </div>
                        <div>
                            <i class="fas fa-wind text-2xl mb-2"></i>
                            <div class="font-bold text-lg">5km/h</div>
                            <div class="text-sm opacity-90">Gi√≥</div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <span class="completion-badge">
                        <i class="fas fa-check mr-2"></i>
                        ƒêi·ªÅu ki·ªán thu·∫≠n l·ª£i
                    </span>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section-card">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button class="btn-secondary" onclick="saveDraft()">
                        <i class="fas fa-save mr-2"></i>L∆∞u nh√°p
                    </button>
                    <button class="btn-secondary" onclick="shareReport()">
                        <i class="fas fa-share mr-2"></i>Chia s·∫ª
                    </button>
                </div>
            </div>
        </div>

        <!-- Submit Button (Fixed on mobile) -->
        <button class="btn-primary" onclick="submitReport()">
            <i class="fas fa-check-circle mr-2"></i>Ho√†n th√†nh ƒë√°nh gi√°
        </button>
    </div>

    <!-- Add Parameter Modal -->
    <div id="parameter-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" onclick="closeParameterModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md" onclick="event.stopPropagation()">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Th√™m tham s·ªë b√°o c√°o</h3>
                
                <div class="space-y-4">
                    <!-- Parameter Templates -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Templates s·∫µn c√≥</label>
                        <select id="parameter-template" class="form-input" onchange="loadParameterTemplate()">
                            <option value="">Ch·ªçn template ho·∫∑c t·ª± nh·∫≠p</option>
                            <optgroup label="üçé ƒê√°nh gi√° s·∫£n l∆∞·ª£ng">
                                <option value="fruit-per-tree">S·ªë tr√°i/c√¢y</option>
                                <option value="fruit-grade-a">Tr√°i lo·∫°i A</option>
                                <option value="fruit-grade-b">Tr√°i lo·∫°i B</option>
                                <option value="fruit-grade-c">Tr√°i lo·∫°i C</option>
                                <option value="avg-fruit-weight">Tr·ªçng l∆∞·ª£ng TB/tr√°i</option>
                                <option value="brix-level">ƒê·ªô Brix</option>
                            </optgroup>
                            <optgroup label="üíß T∆∞·ªõi n∆∞·ªõc">
                                <option value="soil-moisture-before">ƒê·ªô ·∫©m ƒë·∫•t tr∆∞·ªõc t∆∞·ªõi</option>
                                <option value="soil-moisture-after">ƒê·ªô ·∫©m ƒë·∫•t sau t∆∞·ªõi</option>
                                <option value="water-pressure">√Åp l·ª±c n∆∞·ªõc</option>
                                <option value="irrigation-hours">S·ªë gi·ªù t∆∞·ªõi</option>
                                <option value="water-volume">L∆∞·ª£ng n∆∞·ªõc s·ª≠ d·ª•ng</option>
                                <option value="flow-rate">L∆∞u l∆∞·ª£ng</option>
                            </optgroup>
                            <optgroup label="üå± Ph√≤ng tr·ª´ s√¢u b·ªánh">
                                <option value="pest-count-before">S·ªë s√¢u tr∆∞·ªõc x·ª≠ l√Ω</option>
                                <option value="pest-count-after">S·ªë s√¢u sau x·ª≠ l√Ω</option>
                                <option value="affected-leaves">L√° b·ªã b·ªánh (%)</option>
                                <option value="spray-coverage">ƒê·ªô ph·ªß thu·ªëc (%)</option>
                                <option value="chemical-concentration">N·ªìng ƒë·ªô pha ch·∫ø</option>
                            </optgroup>
                            <optgroup label="‚úÇÔ∏è T·ªâa c√†nh">
                                <option value="branches-removed">S·ªë c√†nh ƒë√£ t·ªâa</option>
                                <option value="canopy-coverage">ƒê·ªô ph·ªß t√°n (%)</option>
                                <option value="pruning-intensity">M·ª©c ƒë·ªô t·ªâa (%)</option>
                                <option value="wound-treatment">V·∫øt c·∫Øt x·ª≠ l√Ω (%)</option>
                            </optgroup>
                            <optgroup label="üöú ChƒÉm s√≥c ƒë·∫•t">
                                <option value="soil-ph">pH ƒë·∫•t</option>
                                <option value="soil-ec">EC ƒë·∫•t</option>
                                <option value="organic-matter">Ch·∫•t h·ªØu c∆° (%)</option>
                                <option value="soil-depth">ƒê·ªô s√¢u x·ªõi</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <!-- Custom Parameter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√™n tham s·ªë</label>
                        <input type="text" id="parameter-name" class="form-input" placeholder="VD: S·ªë tr√°i lo·∫°i A">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gi√° tr·ªã</label>
                            <input type="number" id="parameter-value" class="form-input" placeholder="0" step="0.1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ƒê∆°n v·ªã</label>
                            <select id="parameter-unit" class="form-input">
                                <option value="c√°i">c√°i</option>
                                <option value="kg">kg</option>
                                <option value="g">g</option>
                                <option value="l√≠t">l√≠t</option>
                                <option value="ml">ml</option>
                                <option value="%">%</option>
                                <option value="¬∞C">¬∞C</option>
                                <option value="bar">bar</option>
                                <option value="ppm">ppm</option>
                                <option value="pH">pH</option>
                                <option value="gi·ªù">gi·ªù</option>
                                <option value="ph√∫t">ph√∫t</option>
                                <option value="cm">cm</option>
                                <option value="m">m</option>
                                <option value="¬∞Bx">¬∞Bx</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ghi ch√∫ (t√πy ch·ªçn)</label>
                        <input type="text" id="parameter-note" class="form-input" placeholder="VD: ƒêo t·∫°i 10 c√¢y ng·∫´u nhi√™n">
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button class="btn-secondary flex-1" onclick="closeParameterModal()">H·ªßy</button>
                    <button class="btn-primary flex-1" onclick="addParameter()">Th√™m</button>
                </div>
            </div>
        </div>
    </div>
    <div id="metric-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" onclick="closeMetricModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-sm" onclick="event.stopPropagation()">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Ch·ªânh s·ª≠a s·ªë li·ªáu</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="modal-label">L∆∞·ª£ng ph√¢n s·ª≠ d·ª•ng</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="modal-input" class="form-input flex-1" value="288" step="0.1">
                            <span id="modal-unit" class="text-gray-600">kg</span>
                        </div>
                    </div>
                    
                    <div class="text-sm text-gray-600">
                        <div>K·∫ø ho·∫°ch: <span id="modal-target">300 kg</span></div>
                        <div>ƒê·ªô l·ªách: <span id="modal-variance" class="font-medium">-4%</span></div>
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button class="btn-secondary flex-1" onclick="closeMetricModal()">H·ªßy</button>
                    <button class="btn-primary flex-1" onclick="updateMetric()">C·∫≠p nh·∫≠t</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMetricElement = null;
        let currentMetricType = null;
        let customParameterCount = 0;

        // Parameter templates data
        const parameterTemplates = {
            'fruit-per-tree': { name: 'S·ªë tr√°i/c√¢y', unit: 'tr√°i', defaultValue: 15 },
            'fruit-grade-a': { name: 'Tr√°i lo·∫°i A', unit: 'tr√°i', defaultValue: 8 },
            'fruit-grade-b': { name: 'Tr√°i lo·∫°i B', unit: 'tr√°i', defaultValue: 5 },
            'fruit-grade-c': { name: 'Tr√°i lo·∫°i C', unit: 'tr√°i', defaultValue: 2 },
            'avg-fruit-weight': { name: 'Tr·ªçng l∆∞·ª£ng TB/tr√°i', unit: 'kg', defaultValue: 2.5 },
            'brix-level': { name: 'ƒê·ªô Brix', unit: '¬∞Bx', defaultValue: 28 },
            'soil-moisture-before': { name: 'ƒê·ªô ·∫©m ƒë·∫•t tr∆∞·ªõc t∆∞·ªõi', unit: '%', defaultValue: 45 },
            'soil-moisture-after': { name: 'ƒê·ªô ·∫©m ƒë·∫•t sau t∆∞·ªõi', unit: '%', defaultValue: 75 },
            'water-pressure': { name: '√Åp l·ª±c n∆∞·ªõc', unit: 'bar', defaultValue: 2.5 },
            'irrigation-hours': { name: 'S·ªë gi·ªù t∆∞·ªõi', unit: 'gi·ªù', defaultValue: 2.5 },
            'water-volume': { name: 'L∆∞·ª£ng n∆∞·ªõc s·ª≠ d·ª•ng', unit: 'l√≠t', defaultValue: 12000 },
            'flow-rate': { name: 'L∆∞u l∆∞·ª£ng', unit: 'l/ph√∫t', defaultValue: 80 },
            'pest-count-before': { name: 'S·ªë s√¢u tr∆∞·ªõc x·ª≠ l√Ω', unit: 'con/l√°', defaultValue: 12 },
            'pest-count-after': { name: 'S·ªë s√¢u sau x·ª≠ l√Ω', unit: 'con/l√°', defaultValue: 2 },
            'affected-leaves': { name: 'L√° b·ªã b·ªánh', unit: '%', defaultValue: 15 },
            'spray-coverage': { name: 'ƒê·ªô ph·ªß thu·ªëc', unit: '%', defaultValue: 95 },
            'chemical-concentration': { name: 'N·ªìng ƒë·ªô pha ch·∫ø', unit: 'ml/l√≠t', defaultValue: 3 },
            'branches-removed': { name: 'S·ªë c√†nh ƒë√£ t·ªâa', unit: 'c√†nh', defaultValue: 8 },
            'canopy-coverage': { name: 'ƒê·ªô ph·ªß t√°n', unit: '%', defaultValue: 85 },
            'pruning-intensity': { name: 'M·ª©c ƒë·ªô t·ªâa', unit: '%', defaultValue: 25 },
            'wound-treatment': { name: 'V·∫øt c·∫Øt x·ª≠ l√Ω', unit: '%', defaultValue: 100 },
            'soil-ph': { name: 'pH ƒë·∫•t', unit: 'pH', defaultValue: 6.5 },
            'soil-ec': { name: 'EC ƒë·∫•t', unit: 'mS/cm', defaultValue: 1.2 },
            'organic-matter': { name: 'Ch·∫•t h·ªØu c∆°', unit: '%', defaultValue: 3.5 },
            'soil-depth': { name: 'ƒê·ªô s√¢u x·ªõi', unit: 'cm', defaultValue: 25 }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupStarRating();
            setupFileInputs();
            updateProgress();
        });

        // Star rating setup
        function setupStarRating() {
            const stars = document.querySelectorAll('#quality-rating .star');
            
            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    const rating = index + 1;
                    const ratingText = ['R·∫•t k√©m', 'K√©m', 'Trung b√¨nh', 'T·ªët', 'Xu·∫•t s·∫Øc'][index];
                    star.closest('.section-card').querySelector('.text-lg').textContent = `${rating}/5 - ${ratingText}`;
                    
                    updateProgress();
                });
            });
        }

        // Status selection
        function selectStatus(status) {
            document.querySelectorAll('.status-card').forEach(card => {
                card.classList.remove('border-4');
            });
            
            event.currentTarget.classList.add('border-4');
            document.querySelector(`input[value="${status}"]`).checked = true;
            
            updateProgress();
        }

        // Photo capture
        function capturePhoto(phase) {
            const input = document.getElementById(phase + '-camera');
            input.click();
        }

        function setupFileInputs() {
            ['before', 'during', 'after'].forEach(phase => {
                const input = document.getElementById(phase + '-camera');
                input.addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        handlePhotoCapture(phase, e.target.files[0]);
                    }
                });
            });
        }

        function handlePhotoCapture(phase, file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                addPhotoToGallery(phase, e.target.result, file.name);
            };
            reader.readAsDataURL(file);
            
            // Update capture area
            const captureArea = document.querySelector(`#${phase}-camera`).parentElement;
            captureArea.classList.add('has-photo');
            
            const icon = captureArea.querySelector('i');
            const title = captureArea.querySelector('.font-medium');
            
            icon.className = 'fas fa-check-circle text-3xl text-green-600 mb-2';
            title.textContent = 'ƒê√£ ch·ª•p ·∫£nh';
            
            updateProgress();
        }

        function addPhotoToGallery(phase, src, name) {
            const gallery = document.getElementById(phase + '-photos');
            const photoDiv = document.createElement('div');
            photoDiv.className = 'uploaded-photo';
            photoDiv.innerHTML = `
                <img src="${src}" alt="${name}">
                <div class="photo-overlay" onclick="removePhoto(this)">
                    <i class="fas fa-trash"></i>
                </div>
            `;
            gallery.appendChild(photoDiv);
        }

        function removePhoto(element) {
            if (confirm('X√≥a ·∫£nh n√†y?')) {
                element.parentElement.remove();
                updateProgress();
            }
        }

        // Parameter management
        function showAddParameterModal() {
            // Clear previous inputs
            document.getElementById('parameter-template').value = '';
            document.getElementById('parameter-name').value = '';
            document.getElementById('parameter-value').value = '';
            document.getElementById('parameter-unit').value = 'c√°i';
            document.getElementById('parameter-note').value = '';
            
            document.getElementById('parameter-modal').classList.remove('hidden');
        }

        function closeParameterModal() {
            document.getElementById('parameter-modal').classList.add('hidden');
        }

        function loadParameterTemplate() {
            const templateSelect = document.getElementById('parameter-template');
            const selectedTemplate = templateSelect.value;
            
            if (selectedTemplate && parameterTemplates[selectedTemplate]) {
                const template = parameterTemplates[selectedTemplate];
                document.getElementById('parameter-name').value = template.name;
                document.getElementById('parameter-value').value = template.defaultValue;
                document.getElementById('parameter-unit').value = template.unit;
            }
        }

        function addParameter() {
            const name = document.getElementById('parameter-name').value.trim();
            const value = document.getElementById('parameter-value').value.trim();
            const unit = document.getElementById('parameter-unit').value;
            const note = document.getElementById('parameter-note').value.trim();
            
            if (!name || !value) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n tham s·ªë v√† gi√° tr·ªã!');
                return;
            }
            
            const metricsGrid = document.getElementById('metrics-grid');
            customParameterCount++;
            
            const parameterDiv = document.createElement('div');
            parameterDiv.className = 'quick-metric custom-metric';
            parameterDiv.onclick = function() { editCustomMetric(this); };
            
            parameterDiv.innerHTML = `
                <button class="remove-btn" onclick="removeParameter(this, event)" title="X√≥a tham s·ªë">
                    <i class="fas fa-times"></i>
                </button>
                <div class="metric-value">${value}</div>
                <div class="metric-label">${name} (${unit})</div>
                ${note ? `<div class="text-xs text-gray-500 mt-1">${note}</div>` : '<div class="text-xs text-blue-600 mt-1">Tham s·ªë t√πy ch·ªânh</div>'}
            `;
            
            metricsGrid.appendChild(parameterDiv);
            closeParameterModal();
            updateProgress();
            
            // Show success message
            setTimeout(() => {
                alert(`‚úÖ ƒê√£ th√™m tham s·ªë "${name}"\n\nGi√° tr·ªã: ${value} ${unit}${note ? '\nGhi ch√∫: ' + note : ''}`);
            }, 100);
        }

        function removeParameter(button, event) {
            event.stopPropagation();
            
            const parameterDiv = button.closest('.custom-metric');
            const parameterName = parameterDiv.querySelector('.metric-label').textContent;
            
            if (confirm(`X√≥a tham s·ªë "${parameterName}"?`)) {
                parameterDiv.remove();
                customParameterCount--;
                updateProgress();
            }
        }

        function showQuickAddSuggestions() {
            // Determine task type from header (in real app, this would come from task data)
            const taskTitle = document.querySelector('.task-header h1').textContent;
            let suggestions = [];
            
            if (taskTitle.includes('b√≥n ph√¢n')) {
                suggestions = [
                    { key: 'soil-ph', label: 'pH ƒë·∫•t' },
                    { key: 'soil-moisture-before', label: 'ƒê·ªô ·∫©m ƒë·∫•t tr∆∞·ªõc' },
                    { key: 'organic-matter', label: 'Ch·∫•t h·ªØu c∆°' }
                ];
            } else if (taskTitle.includes('t∆∞·ªõi')) {
                suggestions = [
                    { key: 'soil-moisture-before', label: 'ƒê·ªô ·∫©m tr∆∞·ªõc t∆∞·ªõi' },
                    { key: 'soil-moisture-after', label: 'ƒê·ªô ·∫©m sau t∆∞·ªõi' },
                    { key: 'water-pressure', label: '√Åp l·ª±c n∆∞·ªõc' },
                    { key: 'irrigation-hours', label: 'S·ªë gi·ªù t∆∞·ªõi' }
                ];
            } else if (taskTitle.includes('thu ho·∫°ch') || taskTitle.includes('s·∫£n l∆∞·ª£ng')) {
                suggestions = [
                    { key: 'fruit-per-tree', label: 'S·ªë tr√°i/c√¢y' },
                    { key: 'fruit-grade-a', label: 'Tr√°i lo·∫°i A' },
                    { key: 'fruit-grade-b', label: 'Tr√°i lo·∫°i B' },
                    { key: 'avg-fruit-weight', label: 'Tr·ªçng l∆∞·ª£ng TB' },
                    { key: 'brix-level', label: 'ƒê·ªô Brix' }
                ];
            } else if (taskTitle.includes('ph√≤ng tr·ª´') || taskTitle.includes('s√¢u b·ªánh')) {
                suggestions = [
                    { key: 'pest-count-before', label: 'S√¢u tr∆∞·ªõc x·ª≠ l√Ω' },
                    { key: 'pest-count-after', label: 'S√¢u sau x·ª≠ l√Ω' },
                    { key: 'affected-leaves', label: 'L√° b·ªã b·ªánh' },
                    { key: 'spray-coverage', label: 'ƒê·ªô ph·ªß thu·ªëc' }
                ];
            } else if (taskTitle.includes('t·ªâa')) {
                suggestions = [
                    { key: 'branches-removed', label: 'S·ªë c√†nh t·ªâa' },
                    { key: 'pruning-intensity', label: 'M·ª©c ƒë·ªô t·ªâa' },
                    { key: 'canopy-coverage', label: 'ƒê·ªô ph·ªß t√°n' }
                ];
            } else {
                suggestions = [
                    { key: 'soil-ph', label: 'pH ƒë·∫•t' },
                    { key: 'soil-moisture-before', label: 'ƒê·ªô ·∫©m ƒë·∫•t' },
                    { key: 'organic-matter', label: 'Ch·∫•t h·ªØu c∆°' }
                ];
            }
            
            if (suggestions.length === 0) {
                alert('üí° G·ª£i √Ω tham s·ªë\n\nKh√¥ng c√≥ g·ª£i √Ω c·ª• th·ªÉ cho lo·∫°i c√¥ng vi·ªác n√†y.\nVui l√≤ng s·ª≠ d·ª•ng "Th√™m tham s·ªë" ƒë·ªÉ t·ª± ƒë·ªãnh nghƒ©a.');
                return;
            }
            
            let suggestionText = 'üí° G·ª£i √Ω tham s·ªë cho c√¥ng vi·ªác n√†y:\n\n';
            suggestions.forEach((suggestion, index) => {
                const template = parameterTemplates[suggestion.key];
                suggestionText += `${index + 1}. ${suggestion.label}: ${template.defaultValue} ${template.unit}\n`;
            });
            suggestionText += '\nB·∫°n c√≥ mu·ªën th√™m m·ªôt trong c√°c tham s·ªë n√†y kh√¥ng?';
            
            if (confirm(suggestionText)) {
                showAddParameterModal();
                // Pre-select first suggestion
                setTimeout(() => {
                    document.getElementById('parameter-template').value = suggestions[0].key;
                    loadParameterTemplate();
                }, 100);
            }
        }
            const value = element.querySelector('.metric-value').textContent;
            const labelText = element.querySelector('.metric-label').textContent;
            const [name, unit] = labelText.split(' (');
            const unitClean = unit ? unit.replace(')', '') : '';
            
            // Use the same modal but adapt for custom metrics
            currentMetricElement = element;
            
            document.getElementById('modal-label').textContent = name;
            document.getElementById('modal-input').value = value;
            document.getElementById('modal-unit').textContent = unitClean;
            document.getElementById('modal-target').textContent = 'T√πy ch·ªânh';
            document.getElementById('modal-variance').textContent = 'N/A';
            
            document.getElementById('metric-modal').classList.remove('hidden');
        }
        function editMetric(element, type, unit) {
            currentMetricElement = element;
            currentMetricType = type;
            
            const value = element.querySelector('.metric-value').textContent;
            const target = element.querySelector('.metric-value').dataset.target;
            const label = element.querySelector('.metric-label').textContent;
            
            document.getElementById('modal-label').textContent = label;
            document.getElementById('modal-input').value = value;
            document.getElementById('modal-unit').textContent = unit;
            document.getElementById('modal-target').textContent = target + ' ' + unit;
            
            calculateModalVariance();
            document.getElementById('metric-modal').classList.remove('hidden');
        }

        function calculateModalVariance() {
            const input = document.getElementById('modal-input');
            const target = parseFloat(document.getElementById('modal-target').textContent);
            const actual = parseFloat(input.value);
            const variance = Math.round(((actual - target) / target) * 100);
            
            document.getElementById('modal-variance').textContent = (variance > 0 ? '+' : '') + variance + '%';
            document.getElementById('modal-variance').className = `font-medium ${variance >= 0 ? 'text-red-600' : 'text-green-600'}`;
            
            input.addEventListener('input', calculateModalVariance);
        }

        function updateMetric() {
            const newValue = document.getElementById('modal-input').value;
            
            if (!currentMetricElement) return;
            
            currentMetricElement.querySelector('.metric-value').textContent = newValue;
            
            // Check if it's a custom metric or standard metric
            if (currentMetricElement.classList.contains('custom-metric')) {
                // For custom metrics, just update the value
                const noteElement = currentMetricElement.querySelector('.text-xs');
                if (noteElement && noteElement.textContent === 'Tham s·ªë t√πy ch·ªânh') {
                    noteElement.textContent = 'ƒê√£ c·∫≠p nh·∫≠t';
                    noteElement.className = 'text-xs text-green-600 mt-1';
                }
            } else {
                // For standard metrics, calculate variance
                const variance = document.getElementById('modal-variance').textContent;
                const varianceElement = currentMetricElement.querySelector('.text-xs');
                varianceElement.textContent = variance + ' so v·ªõi k·∫ø ho·∫°ch';
                
                const varianceNum = parseFloat(variance);
                varianceElement.className = `text-xs mt-1 ${Math.abs(varianceNum) <= 10 ? 'text-green-600' : varianceNum > 0 ? 'text-red-600' : 'text-orange-600'}`;
            }
            
            closeMetricModal();
            updateProgress();
        }

        function closeMetricModal() {
            document.getElementById('metric-modal').classList.add('hidden');
            currentMetricElement = null;
            currentMetricType = null;
        }

        // Progress tracking
        function updateProgress() {
            let progress = 0;
            
            // Status selected
            if (document.querySelector('input[name="status"]:checked')) progress += 20;
            
            // Metrics filled (including custom parameters)
            const allMetrics = document.querySelectorAll('.quick-metric');
            progress += Math.min(40, allMetrics.length * 5); // Cap at 40 points for metrics
            
            // Rating given
            const activeStars = document.querySelectorAll('#quality-rating .star.active');
            if (activeStars.length > 0) progress += 15;
            
            // Photos taken
            const photos = document.querySelectorAll('.uploaded-photo');
            progress += Math.min(20, photos.length * 7);
            
            // Notes written
            const notes = document.querySelectorAll('textarea');
            let notesWritten = 0;
            notes.forEach(note => {
                if (note.value.trim().length > 10) notesWritten++;
            });
            progress += notesWritten * 5;
            
            progress = Math.min(100, progress);
            
            // Update progress circle
            const circle = document.querySelector('.progress-circle');
            const degrees = (progress / 100) * 360;
            circle.style.background = `conic-gradient(#22c55e 0deg, #22c55e ${degrees}deg, #e5e7eb ${degrees}deg)`;
            
            document.querySelector('.progress-text').textContent = progress + '%';
        }

        // Main actions
        function saveDraft() {
            const progress = document.querySelector('.progress-text').textContent;
            alert(`üíæ ƒê√£ l∆∞u nh√°p\n\nTi·∫øn ƒë·ªô: ${progress}\nB·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c ho√†n th√†nh sau.`);
        }

        function shareReport() {
            if (navigator.share) {
                navigator.share({
                    title: 'B√°o c√°o c√¥ng vi·ªác - B√≥n ph√¢n NPK',
                    text: 'Chia s·∫ª b√°o c√°o th·ª±c hi·ªán c√¥ng vi·ªác',
                    url: window.location.href
                });
            } else {
                alert('üì§ Chia s·∫ª b√°o c√°o\n\nLink b√°o c√°o ƒë√£ ƒë∆∞·ª£c sao ch√©p v√†o clipboard.');
            }
        }

        function submitReport() {
            const progress = parseInt(document.querySelector('.progress-text').textContent);
            const status = document.querySelector('input[name="status"]:checked')?.value || 'completed';
            const rating = document.querySelectorAll('#quality-rating .star.active').length;
            const customParams = document.querySelectorAll('.custom-metric').length;
            const totalParams = document.querySelectorAll('.quick-metric').length;
            
            if (progress < 70) {
                alert('‚ö†Ô∏è B√°o c√°o ch∆∞a ƒë·∫ßy ƒë·ªß\n\nVui l√≤ng ho√†n th√†nh √≠t nh·∫•t 70% ƒë·ªÉ g·ª≠i b√°o c√°o.\nHi·ªán t·∫°i: ' + progress + '%');
                return;
            }
            
            let reportSummary = `G·ª≠i b√°o c√°o ƒë√°nh gi√°?\n\n‚Ä¢ Tr·∫°ng th√°i: ${getStatusText(status)}\n‚Ä¢ ƒê√°nh gi√°: ${rating}/5 sao\n‚Ä¢ Ti·∫øn ƒë·ªô: ${progress}%\n‚Ä¢ Tham s·ªë: ${totalParams} (${customParams} t√πy ch·ªânh)`;
            
            if (customParams > 0) {
                reportSummary += `\n‚Ä¢ Chi ti·∫øt t√πy ch·ªânh: ${customParams} tham s·ªë b·ªï sung`;
            }
            
            reportSummary += `\n\nSau khi g·ª≠i, b√°o c√°o s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o h·ªá th·ªëng.`;
            
            if (confirm(reportSummary)) {
                // Simulate submission
                setTimeout(() => {
                    let successMessage = `‚úÖ ƒê√£ g·ª≠i b√°o c√°o th√†nh c√¥ng!\n\n‚Ä¢ M√£ b√°o c√°o: RPT_${Date.now()}\n‚Ä¢ Tr·∫°ng th√°i: ${getStatusText(status)}\n‚Ä¢ ƒêi·ªÉm ƒë√°nh gi√°: ${rating}/5\n‚Ä¢ T·ªïng tham s·ªë: ${totalParams}`;
                    
                    if (customParams > 0) {
                        successMessage += `\n‚Ä¢ Tham s·ªë t√πy ch·ªânh: ${customParams}\n‚Ä¢ D·ªØ li·ªáu chi ti·∫øt ƒë√£ ƒë∆∞·ª£c l∆∞u`;
                    }
                    
                    successMessage += `\n‚Ä¢ C√¥ng vi·ªác ti·∫øp theo s·∫Ω ƒë∆∞·ª£c th√¥ng b√°o trong 2 ng√†y.`;
                    
                    alert(successMessage);
                    
                    // Show parameter summary if any custom params
                    if (customParams > 0) {
                        setTimeout(() => {
                            const customMetrics = document.querySelectorAll('.custom-metric');
                            let paramSummary = 'üìä Tham s·ªë t√πy ch·ªânh ƒë√£ l∆∞u:\n\n';
                            customMetrics.forEach((metric, index) => {
                                const value = metric.querySelector('.metric-value').textContent;
                                const label = metric.querySelector('.metric-label').textContent;
                                paramSummary += `${index + 1}. ${label}: ${value}\n`;
                            });
                            paramSummary += '\nD·ªØ li·ªáu n√†y s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng cho ph√¢n t√≠ch v√† b√°o c√°o t·ªïng h·ª£p.';
                            alert(paramSummary);
                        }, 1000);
                    }
                    
                    // Redirect or close
                    // window.location.href = '/tasks';
                }, 500);
            }
        }

        function getStatusText(status) {
            const statusTexts = {
                'completed': 'Ho√†n th√†nh ƒë·∫ßy ƒë·ªß',
                'partial': 'Ho√†n th√†nh m·ªôt ph·∫ßn',
                'failed': 'Kh√¥ng ho√†n th√†nh'
            };
            return statusTexts[status] || 'Ch∆∞a x√°c ƒë·ªãnh';
        }

        // Prevent accidental page refresh
        window.addEventListener('beforeunload', function (e) {
            const progress = parseInt(document.querySelector('.progress-text').textContent);
            if (progress > 0 && progress < 100) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>