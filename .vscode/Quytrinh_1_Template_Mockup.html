<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X√¢y d·ª±ng Quy tr√¨nh Canh t√°c To√†n di·ªán</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #1a202c;
        }
        
        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #0f766e 0%, #059669 100%);
            color: white;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="rgba(255,255,255,0.1)"><polygon points="0,100 1000,0 1000,100"/></svg>');
            background-size: cover;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
        }
        
        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 2rem;
            padding: 2rem;
        }
        
        .content-area {
            min-width: 0;
        }
        
        .sidebar {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }
        
        .section {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            border-color: #10b981;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
        }
        
        .section-header {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #d1fae5;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #065f46;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-icon {
            width: 24px;
            height: 24px;
            background: #10b981;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }
        
        .section-body {
            padding: 1.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }
        
        .form-grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 1rem;
        }
        
        .form-group {
            position: relative;
        }
        
        .form-group.span-2 {
            grid-column: span 2;
        }
        
        .form-group.span-full {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            background: #ffffff;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .autocomplete-suggestion {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.875rem;
        }
        
        .autocomplete-suggestion:hover {
            background: #f9fafb;
        }
        
        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .btn-sm {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }
        
        .stage-item {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .stage-item:hover {
            border-color: #10b981;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.08);
        }
        
        .stage-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .stage-number {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .stage-content {
            padding: 1.25rem;
        }
        
        .work-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px dashed #e5e7eb;
        }
        
        .work-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .work-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .work-item {
            background: #fafbfc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        
        .work-item:hover {
            border-color: #fbbf24;
            background: #fffbeb;
        }
        
        .work-header {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 0.875rem 1rem;
            border-bottom: 1px solid #f59e0b;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .work-number {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
        }
        
        .work-content {
            padding: 1rem;
        }
        
        .work-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .subwork-item {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            margin-left: 1rem;
            border-left: 3px solid #64748b;
        }
        
        .subwork-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .subwork-number {
            background: #64748b;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6875rem;
            font-weight: 600;
        }
        
        .environment-section {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 1px solid #a7f3d0;
            border-radius: 10px;
            padding: 1.25rem;
            margin-top: 1rem;
        }
        
        .environment-title {
            font-size: 1rem;
            font-weight: 600;
            color: #065f46;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .save-section {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem;
            text-align: center;
            border-top: 1px solid #e2e8f0;
            grid-column: 1 / -1;
        }
        
        .save-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            padding: 0.875rem 2rem;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .required {
            color: #ef4444;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #3730a3;
            margin-top: 0.25rem;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                padding: 1rem;
                gap: 1rem;
            }
            
            .sidebar {
                position: static;
                order: -1;
            }
            
            .form-grid,
            .form-grid-2,
            .form-grid-3,
            .form-grid-4 {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .save-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .work-controls {
                flex-direction: column;
            }
            
            .work-controls .btn {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>üß¨ H·ªá th·ªëng X√¢y d·ª±ng Quy tr√¨nh Canh t√°c To√†n di·ªán</h1>
                <p>Platform khoa h·ªçc cho nghi√™n c·ª©u v√† xu·∫•t b·∫£n quy tr√¨nh k·ªπ thu·∫≠t s·∫£n xu·∫•t n√¥ng nghi·ªáp hi·ªán ƒë·∫°i</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="content-area">
                <!-- Th√¥ng tin c∆° b·∫£n -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span class="section-icon">üìã</span>
                            Th√¥ng tin c∆° b·∫£n
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="organization">ƒê∆°n v·ªã x√¢y d·ª±ng/xu·∫•t b·∫£n quy tr√¨nh <span class="required">*</span></label>
                                <input type="text" id="organization" placeholder="VD: Vi·ªán Nghi√™n c·ª©u N√¥ng nghi·ªáp Vi·ªát Nam">
                            </div>
                            <div class="form-group">
                                <label for="project">D·ª± √°n <span class="required">*</span></label>
                                <input type="text" id="project" placeholder="VD: Nghi√™n c·ª©u quy tr√¨nh canh t√°c b·ªÅn v·ªØng">
                            </div>
                            <div class="form-group span-full">
                                <label for="author">Ng∆∞·ªùi x√¢y d·ª±ng/ƒê·ªÅ xu·∫•t <span class="required">*</span></label>
                                <input type="text" id="author" placeholder="VD: TS. Nguy·ªÖn VƒÉn A, ThS. Tr·∫ßn Th·ªã B">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Th√¥ng tin ƒë·ªëi t∆∞·ª£ng s·∫£n xu·∫•t -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span class="section-icon">üéØ</span>
                            Th√¥ng tin ƒë·ªëi t∆∞·ª£ng s·∫£n xu·∫•t
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="production-type">ƒê·ªëi t∆∞·ª£ng s·∫£n xu·∫•t <span class="required">*</span></label>
                                <select id="production-type" onchange="updateSpecificOptions()">
                                    <option value="">Ch·ªçn ƒë·ªëi t∆∞·ª£ng s·∫£n xu·∫•t</option>
                                    <option value="crops">Tr·ªìng tr·ªçt</option>
                                    <option value="livestock">ChƒÉn nu√¥i</option>
                                    <option value="aquaculture">Th·ªßy h·∫£i s·∫£n</option>
                                    <option value="ornamental">Sinh v·∫≠t c·∫£nh</option>
                                    <option value="other">Kh√°c</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="specific-object">ƒê·ªëi t∆∞·ª£ng c·ª• th·ªÉ <span class="required">*</span></label>
                                <select id="specific-object">
                                    <option value="">Ch·ªçn ƒë·ªëi t∆∞·ª£ng c·ª• th·ªÉ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="variety">Gi·ªëng</label>
                                <input type="text" id="variety" placeholder="VD: S·∫ßu ri√™ng Ri6, C√† ph√™ Robusta">
                            </div>
                            <div class="form-group">
                                <label for="region">Khu v·ª±c √°p d·ª•ng</label>
                                <input type="text" id="region" placeholder="VD: ƒê·ªìng b·∫±ng s√¥ng C·ª≠u Long, T√¢y Nguy√™n">
                            </div>
                            <div class="form-group span-full">
                                <label for="description">M√¥ t·∫£</label>
                                <textarea id="description" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ quy tr√¨nh, ƒëi·ªÅu ki·ªán √°p d·ª•ng, l·ª£i √≠ch..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tham s·ªë sinh tr∆∞·ªüng -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span class="section-icon">üìä</span>
                            Tham s·ªë sinh tr∆∞·ªüng
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="growth-variety">Gi·ªëng ch√≠nh</label>
                                <input type="text" id="growth-variety" placeholder="Gi·ªëng s·ª≠ d·ª•ng">
                            </div>
                            <div class="form-group">
                                <label for="harvest-age">Tu·ªïi b·∫Øt ƒë·∫ßu thu ho·∫°ch</label>
                                <input type="text" id="harvest-age" placeholder="VD: 3-4 nƒÉm">
                            </div>
                            <div class="form-group">
                                <label for="stable-age">Tu·ªïi ·ªïn ƒë·ªãnh</label>
                                <input type="text" id="stable-age" placeholder="VD: 7-8 nƒÉm">
                            </div>
                            <div class="form-group">
                                <label for="seasons-per-year">S·ªë v·ª•/L·ª©a m·ªói nƒÉm</label>
                                <input type="number" id="seasons-per-year" placeholder="VD: 2">
                            </div>
                            <div class="form-group">
                                <label for="growth-days">Ng√†y sinh tr∆∞·ªüng tr√°i/Mang thai</label>
                                <input type="text" id="growth-days" placeholder="VD: 110-130 ng√†y">
                            </div>
                            <div class="form-group">
                                <label for="density">M·∫≠t ƒë·ªô/T·ªâ l·ªá C√¢y/Con</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="density" placeholder="VD: 200" style="flex: 1;">
                                    <select style="width: 120px;">
                                        <option>c√¢y/ha</option>
                                        <option>con/m¬≤</option>
                                        <option>c√¢y/m¬≤</option>
                                        <option>con/ha</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="yield">NƒÉng su·∫•t/S·∫£n l∆∞·ª£ng</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="yield" placeholder="VD: 15-20" style="flex: 1;">
                                    <select style="width: 100px;">
                                        <option>kg/c√¢y</option>
                                        <option>kg/con</option>
                                        <option>t·∫•n/ha</option>
                                        <option>kg/m¬≤</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="environment-section">
                            <h3 class="environment-title">üå°Ô∏è Tham s·ªë m√¥i tr∆∞·ªùng</h3>
                            <div class="form-grid-3">
                                <div class="form-group">
                                    <label for="soil-ph">pH ƒë·∫•t</label>
                                    <input type="text" id="soil-ph" placeholder="VD: 5.5-6.5">
                                </div>
                                <div class="form-group">
                                    <label for="temperature">Nhi·ªát ƒë·ªô (¬∞C)</label>
                                    <input type="text" id="temperature" placeholder="VD: 25-30¬∞C">
                                </div>
                                <div class="form-group">
                                    <label for="humidity">ƒê·ªô ·∫©m (%)</label>
                                    <input type="text" id="humidity" placeholder="VD: 70-85%">
                                </div>
                                <div class="form-group">
                                    <label for="rainfall">L∆∞·ª£ng m∆∞a (mm/nƒÉm)</label>
                                    <input type="text" id="rainfall" placeholder="VD: 1500-2500mm">
                                </div>
                                <div class="form-group">
                                    <label for="sunlight">√Ånh s√°ng</label>
                                    <input type="text" id="sunlight" placeholder="VD: 6-8 gi·ªù/ng√†y">
                                </div>
                                <div class="form-group">
                                    <label for="altitude">ƒê·ªô cao (m)</label>
                                    <input type="text" id="altitude" placeholder="VD: 0-800m">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Giai ƒëo·∫°n v√† c√¥ng vi·ªác -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            Giai ƒëo·∫°n v√† c√¥ng vi·ªác chi ti·∫øt
                        </h2>
                    </div>
                    <div class="section-body">
                        <div id="stages-container">
                            <!-- Stages will be dynamically added here -->
                        </div>
                        <button type="button" class="btn" onclick="addStage()">
                            ‚ûï Th√™m giai ƒëo·∫°n m·ªõi
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Th·ªëng k√™ quy tr√¨nh -->
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title" style="font-size: 1rem;">
                            <span class="section-icon">üìà</span>
                            Th·ªëng k√™ quy tr√¨nh
                        </h3>
                    </div>
                    <div class="section-body">
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <span style="font-size: 0.875rem; color: #6b7280;">T·ªïng giai ƒëo·∫°n</span>
                                <span style="font-weight: 600; color: #1f2937;" id="total-stages">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Thi·∫øt l·∫≠p 1 l·∫ßn</span>
                                <span style="font-weight: 600; color: #059669;" id="onetime-stages">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <span style="font-size: 0.875rem; color: #6b7280;">L·∫∑p l·∫°i chu k·ª≥</span>
                                <span style="font-weight: 600; color: #dc2626;" id="cyclic-stages">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <span style="font-size: 0.875rem; color: #6b7280;">T·ªïng c√¥ng vi·ªác</span>
                                <span style="font-weight: 600; color: #1f2937;" id="total-works">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Ho√†n thi·ªán</span>
                                <span style="font-weight: 600; color: #3b82f6;" id="completion-percent">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tham s·ªë t·ªïng quan -->
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title" style="font-size: 1rem;">
                            <span class="section-icon">üìã</span>
                            Tham s·ªë t·ªïng quan
                        </h3>
                    </div>
                    <div class="section-body">
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Tu·ªïi thu ho·∫°ch</div>
                                <div style="font-weight: 500; color: #1f2937;" id="summary-harvest-age">Ch∆∞a nh·∫≠p</div>
                            </div>
                            <div style="padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Th·ªùi gian sinh tr∆∞·ªüng</div>
                                <div style="font-weight: 500; color: #1f2937;" id="summary-growth-days">Ch∆∞a nh·∫≠p</div>
                            </div>
                            <div style="padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">M·∫≠t ƒë·ªô/T·ªâ l·ªá</div>
                                <div style="font-weight: 500; color: #1f2937;" id="summary-density">Ch∆∞a nh·∫≠p</div>
                            </div>
                            <div style="padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">NƒÉng su·∫•t m·ª•c ti√™u</div>
                                <div style="font-weight: 500; color: #1f2937;" id="summary-yield">Ch∆∞a nh·∫≠p</div>
                            </div>
                            <div style="padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb;">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">S·ªë v·ª•/nƒÉm</div>
                                <div style="font-weight: 500; color: #1f2937;" id="summary-seasons">Ch∆∞a nh·∫≠p</div>
                            </div>
                            <div style="padding: 0.5rem 0;">
                                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Khu v·ª±c ch√≠nh</div>
                                <div style="font-weight: 500; color: #1f2937;" id="summary-region">Ch∆∞a nh·∫≠p</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Th∆∞ vi·ªán Template -->
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title" style="font-size: 1rem;">
                            <span class="section-icon">üìö</span>
                            Th∆∞ vi·ªán Template
                        </h3>
                    </div>
                    <div class="section-body">
                        <div style="margin-bottom: 1rem;">
                            <h4 style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;">üå± Giai ƒëo·∫°n m·∫´u</h4>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button class="btn btn-sm btn-secondary" onclick="applyStageTemplate('C·∫£i t·∫°o ƒë·∫•t')" style="justify-content: flex-start; font-size: 0.75rem;">C·∫£i t·∫°o ƒë·∫•t</button>
                                <button class="btn btn-sm btn-secondary" onclick="applyStageTemplate('Tr·ªìng c√¢y con')" style="justify-content: flex-start; font-size: 0.75rem;">Tr·ªìng c√¢y con</button>
                                <button class="btn btn-sm btn-secondary" onclick="applyStageTemplate('X·ª≠ l√Ω ra hoa')" style="justify-content: flex-start; font-size: 0.75rem;">X·ª≠ l√Ω ra hoa</button>
                                <button class="btn btn-sm btn-secondary" onclick="applyStageTemplate('X·ª≠ l√Ω s√¢u b·ªánh')" style="justify-content: flex-start; font-size: 0.75rem;">X·ª≠ l√Ω s√¢u b·ªánh</button>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;">üß¨ Tham s·ªë theo gi·ªëng</h4>
                            <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem;" onchange="applyVarietyParams(this.value)">
                                <option value="">Ch·ªçn gi·ªëng m·∫´u</option>
                                <option value="durian-ri6">S·∫ßu ri√™ng Ri6</option>
                                <option value="coffee-robusta">C√† ph√™ Robusta</option>
                                <option value="passion-fruit">Chanh leo</option>
                                <option value="cacao">Cacao</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Section -->
        <div class="save-section">
            <div class="save-controls">
                <button type="button" class="btn btn-primary" onclick="saveProcess()">
                    üíæ L∆∞u v√† Xu·∫•t b·∫£n Quy tr√¨nh
                </button>
                <button type="button" class="btn btn-secondary" onclick="previewProcess()">
                    üëÅÔ∏è Xem tr∆∞·ªõc
                </button>
                <button type="button" class="btn btn-secondary" onclick="exportProcess()">
                    üìÑ Xu·∫•t file PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        let stageCounter = 0;
        let workCounter = 0;
        let subworkCounter = 0;
        
        // Th∆∞ vi·ªán g·ª£i √Ω giai ƒëo·∫°n
        const stageLibrary = {
            crops: [
                'Chu·∫©n b·ªã ƒë·∫•t v√† m√¥i tr∆∞·ªùng',
                'X·ª≠ l√Ω gi·ªëng v√† nh√¢n gi·ªëng',
                'Tr·ªìng v√† chƒÉm s√≥c ban ƒë·∫ßu',
                'B√≥n ph√¢n v√† t∆∞·ªõi n∆∞·ªõc',
                'Ph√≤ng tr·ª´ s√¢u b·ªánh',
                'ChƒÉm s√≥c v√† t·ªâa c√†nh',
                'Thu ho·∫°ch v√† b·∫£o qu·∫£n',
                'X·ª≠ l√Ω sau thu ho·∫°ch'
            ],
            livestock: [
                'Chu·∫©n b·ªã chu·ªìng tr·∫°i',
                'Ch·ªçn gi·ªëng v√† nh·∫≠p ƒë√†n',
                'ChƒÉm s√≥c giai ƒëo·∫°n non',
                'Cho ƒÉn v√† dinh d∆∞·ª°ng',
                'Ph√≤ng b·ªánh v√† ti√™m ph√≤ng',
                'ChƒÉm s√≥c sinh s·∫£n',
                'Thu ho·∫°ch s·∫£n ph·∫©m',
                'X·ª≠ l√Ω ch·∫•t th·∫£i'
            ],
            aquaculture: [
                'Chu·∫©n b·ªã ao v√† m√¥i tr∆∞·ªùng n∆∞·ªõc',
                'Th·∫£ gi·ªëng v√† qu·∫£n l√Ω m·∫≠t ƒë·ªô',
                'Cho ƒÉn v√† dinh d∆∞·ª°ng',
                'Qu·∫£n l√Ω ch·∫•t l∆∞·ª£ng n∆∞·ªõc',
                'Ph√≤ng tr·ª´ b·ªánh',
                'Theo d√µi sinh tr∆∞·ªüng',
                'Thu ho·∫°ch v√† b·∫£o qu·∫£n',
                'X·ª≠ l√Ω m√¥i tr∆∞·ªùng'
            ]
        };
        
        // Th∆∞ vi·ªán g·ª£i √Ω c√¥ng vi·ªác
        const workLibrary = {
            'Chu·∫©n b·ªã ƒë·∫•t v√† m√¥i tr∆∞·ªùng': [
                'L√†m ƒë·∫•t v√† x·ªõi b·ª´a',
                'B√≥n ph√¢n c∆° b·∫£n',
                'X·ª≠ l√Ω pH ƒë·∫•t',
                'L√†m h·ªá th·ªëng t∆∞·ªõi',
                'Chu·∫©n b·ªã gi√†n ƒë·ª°'
            ],
            'X·ª≠ l√Ω gi·ªëng v√† nh√¢n gi·ªëng': [
                'Ch·ªçn l·ªçc gi·ªëng',
                'X·ª≠ l√Ω h·∫°t gi·ªëng',
                '∆Ø∆°m c√¢y gi·ªëng',
                'Ki·ªÉm tra ch·∫•t l∆∞·ª£ng gi·ªëng',
                'V·∫≠n chuy·ªÉn gi·ªëng'
            ],
            'Tr·ªìng v√† chƒÉm s√≥c ban ƒë·∫ßu': [
                'Tr·ªìng c√¢y theo kho·∫£ng c√°ch',
                'T∆∞·ªõi n∆∞·ªõc sau tr·ªìng',
                'Ph·ªß mulch',
                'D·ª±ng c√¢y',
                'Ki·ªÉm tra t·ª∑ l·ªá s·ªëng'
            ],
            'Chu·∫©n b·ªã chu·ªìng tr·∫°i': [
                'X√¢y d·ª±ng chu·ªìng',
                'L·∫Øp ƒë·∫∑t h·ªá th·ªëng th√¥ng gi√≥',
                'Chu·∫©n b·ªã h·ªá th·ªëng c·∫•p n∆∞·ªõc',
                'Kh·ª≠ tr√πng chu·ªìng',
                'Chu·∫©n b·ªã th·ª©c ƒÉn'
            ],
            'Ch·ªçn gi·ªëng v√† nh·∫≠p ƒë√†n': [
                'L·ª±a ch·ªçn gi·ªëng',
                'Ki·ªÉm tra s·ª©c kh·ªèe',
                'V·∫≠n chuy·ªÉn',
                'C√°ch ly quan s√°t',
                'Ti√™m ph√≤ng c∆° b·∫£n'
            ]
        };
        
        // Object mapping for specific options
        const specificOptions = {
            crops: ['S·∫ßu ri√™ng', 'C√† ph√™', 'Chanh leo', 'Cacao', 'L√∫a', 'Ng√¥', 'Khoai lang', 'Kh√°c'],
            livestock: ['L·ª£n', 'G√†', 'B√≤', 'V·ªãt', 'D√™', 'C·ª´u', 'Th·ªè', 'Kh√°c'],
            aquaculture: ['C√° tra', 'C√° basa', 'T√¥m th·∫ª ch√¢n tr·∫Øng', 'C√° l√≥c', 'C√° di√™u h·ªìng', 'Kh√°c'],
            ornamental: ['Hoa lan', 'Hoa h·ªìng', 'C√¢y c·∫£nh', 'C√° c·∫£nh', 'Chim c·∫£nh', 'Kh√°c'],
            other: ['Kh√°c']
        };

        function updateSpecificOptions() {
            const productionType = document.getElementById('production-type').value;
            const specificSelect = document.getElementById('specific-object');
            
            specificSelect.innerHTML = '<option value="">Ch·ªçn ƒë·ªëi t∆∞·ª£ng c·ª• th·ªÉ</option>';
            
            if (productionType && specificOptions[productionType]) {
                specificOptions[productionType].forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.toLowerCase().replace(/ /g, '-');
                    optionElement.textContent = option;
                    specificSelect.appendChild(optionElement);
                });
            }
        }

        function createAutocomplete(input, suggestions) {
            const container = document.createElement('div');
            container.className = 'autocomplete-container';
            input.parentNode.insertBefore(container, input);
            container.appendChild(input);
            
            const suggestionsList = document.createElement('div');
            suggestionsList.className = 'autocomplete-suggestions';
            container.appendChild(suggestionsList);
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                suggestionsList.innerHTML = '';
                
                if (value) {
                    const filtered = suggestions.filter(item => 
                        item.toLowerCase().includes(value)
                    );
                    
                    if (filtered.length > 0) {
                        filtered.forEach(item => {
                            const div = document.createElement('div');
                            div.className = 'autocomplete-suggestion';
                            div.textContent = item;
                            div.onclick = () => {
                                input.value = item;
                                suggestionsList.style.display = 'none';
                                input.focus();
                            };
                            suggestionsList.appendChild(div);
                        });
                        suggestionsList.style.display = 'block';
                    } else {
                        suggestionsList.style.display = 'none';
                    }
                } else {
                    suggestionsList.style.display = 'none';
                }
            });
            
            input.addEventListener('focus', function() {
                if (suggestionsList.children.length > 0) {
                    suggestionsList.style.display = 'block';
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                    suggestionsList.style.display = 'none';
                }
            });
        }

        function addStage() {
            stageCounter++;
            const stagesContainer = document.getElementById('stages-container');
            const productionType = document.getElementById('production-type').value;
            const suggestions = stageLibrary[productionType] || [];
            
            const stageHtml = `
                <div class="stage-item" id="stage-${stageCounter}">
                    <div class="stage-header">
                        <div class="stage-number">${stageCounter}</div>
                        <div style="flex: 1;">
                            <input type="text" id="stage-name-${stageCounter}" placeholder="T√™n giai ƒëo·∫°n (VD: Chu·∫©n b·ªã v√† x·ª≠ l√Ω ƒë·∫•t)" style="width: 100%; border: none; background: transparent; font-weight: 600; font-size: 1rem;">
                        </div>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeStage(${stageCounter})">üóëÔ∏è X√≥a</button>
                    </div>
                    
                    <div class="stage-content">
                        <div class="form-grid-4">
                            <div class="form-group">
                                <label>Th·ªùi gian th·ª±c hi·ªán</label>
                                <input type="text" placeholder="VD: 15-30 ng√†y">
                            </div>
                            <div class="form-group">
                                <label>Th·ªùi gian tri·ªÉn khai t·ªëi ∆∞u</label>
                                <input type="text" placeholder="VD: Th√°ng 1-2">
                            </div>
                            <div class="form-group">
                                <label>Lo·∫°i c√¥ng vi·ªác</label>
                                <select>
                                    <option value="">Ch·ªçn lo·∫°i</option>
                                    <option value="onetime">Thi·∫øt l·∫≠p 1 l·∫ßn</option>
                                    <option value="cyclic">L·∫∑p l·∫°i theo chu k·ª≥</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ƒê·ªô ∆∞u ti√™n</label>
                                <select>
                                    <option value="high">Cao</option>
                                    <option value="medium">Trung b√¨nh</option>
                                    <option value="low">Th·∫•p</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>M√¥ t·∫£ c∆° b·∫£n giai ƒëo·∫°n</label>
                            <textarea placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ giai ƒëo·∫°n n√†y..."></textarea>
                        </div>
                        
                        <div class="work-section">
                            <div class="work-section-header">
                                <h4 class="work-section-title">
                                    üîß C√¥ng vi·ªác trong giai ƒëo·∫°n
                                </h4>
                                <button type="button" class="btn btn-sm" onclick="addWork(${stageCounter})">‚ûï Th√™m c√¥ng vi·ªác</button>
                            </div>
                            <div id="works-${stageCounter}" class="works-container">
                                <!-- Works will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            stagesContainer.insertAdjacentHTML('beforeend', stageHtml);
            
            // Add autocomplete for stage name
            setTimeout(() => {
                const stageInput = document.getElementById(`stage-name-${stageCounter}`);
                if (suggestions.length > 0) {
                    createAutocomplete(stageInput, suggestions);
                }
            }, 100);
            
            updateStats();
        }

        function removeStage(stageId) {
            const stage = document.getElementById(`stage-${stageId}`);
            if (stage && confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a giai ƒëo·∫°n n√†y?')) {
                stage.remove();
                updateStats();
            }
        }

        function addWork(stageId) {
            workCounter++;
            const worksContainer = document.getElementById(`works-${stageId}`);
            const workNumber = worksContainer.children.length + 1;
            
            // Get current stage name for work suggestions
            const stageNameInput = document.getElementById(`stage-name-${stageId}`);
            const stageName = stageNameInput ? stageNameInput.value : '';
            const workSuggestions = workLibrary[stageName] || [
                'Chu·∫©n b·ªã v·∫≠t t∆∞',
                'Th·ª±c hi·ªán c√¥ng vi·ªác ch√≠nh',
                'Ki·ªÉm tra ch·∫•t l∆∞·ª£ng',
                'Ghi nh·∫≠n k·∫øt qu·∫£',
                'D·ªçn d·∫πp v√† b·∫£o qu·∫£n'
            ];
            
            const workHtml = `
                <div class="work-item" id="work-${workCounter}">
                    <div class="work-header">
                        <div class="work-number">${workNumber}</div>
                        <div style="flex: 1;">
                            <input type="text" id="work-name-${workCounter}" placeholder="T√™n c√¥ng vi·ªác (VD: L√†m ƒë·∫•t, B√≥n ph√¢n c∆° b·∫£n)" style="width: 100%; border: none; background: transparent; font-weight: 500;">
                        </div>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeWork(${workCounter})">üóëÔ∏è</button>
                    </div>
                    
                    <div class="work-content">
                        <div class="form-grid-4">
                            <div class="form-group">
                                <label>Th·ªùi gian th·ª±c hi·ªán</label>
                                <input type="text" placeholder="VD: 3-5 ng√†y">
                            </div>
                            <div class="form-group">
                                <label>Th·ªùi ƒëi·ªÉm th·ª±c hi·ªán</label>
                                <input type="text" placeholder="VD: Tr∆∞·ªõc khi tr·ªìng 2 tu·∫ßn">
                            </div>
                            <div class="form-group">
                                <label>Lo·∫°i c√¥ng vi·ªác</label>
                                <select>
                                    <option value="">Ch·ªçn lo·∫°i</option>
                                    <option value="onetime">Thi·∫øt l·∫≠p 1 l·∫ßn</option>
                                    <option value="cyclic">L·∫∑p l·∫°i theo chu k·ª≥</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>M·ª©c ƒë·ªô quan tr·ªçng</label>
                                <select>
                                    <option value="critical">R·∫•t quan tr·ªçng</option>
                                    <option value="important">Quan tr·ªçng</option>
                                    <option value="normal">B√¨nh th∆∞·ªùng</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>M√¥ t·∫£ c√¥ng vi·ªác</label>
                            <textarea placeholder="M√¥ t·∫£ chi ti·∫øt c√°ch th·ª±c hi·ªán c√¥ng vi·ªác n√†y..."></textarea>
                        </div>
                        
                        <div class="work-controls">
                            <button type="button" class="btn btn-sm" onclick="setupWorkDetails(${workCounter})">‚öôÔ∏è Thi·∫øt l·∫≠p Chi ti·∫øt</button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="setupEvaluationCriteria(${workCounter})">üìã Ti√™u chu·∫©n ƒë√°nh gi√°</button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="addSubWork(${workCounter})">‚ûï Th√™m c√¥ng vi·ªác con</button>
                        </div>
                        
                        <div id="subworks-${workCounter}" class="subworks-container" style="margin-top: 1rem;">
                            <!-- Sub-works will be added here -->
                        </div>
                    </div>
                </div>
            `;
            
            worksContainer.insertAdjacentHTML('beforeend', workHtml);
            
            // Add autocomplete for work name
            setTimeout(() => {
                const workInput = document.getElementById(`work-name-${workCounter}`);
                createAutocomplete(workInput, workSuggestions);
            }, 100);
            
            updateStats();
        }

        function removeWork(workId) {
            const work = document.getElementById(`work-${workId}`);
            if (work && confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√¥ng vi·ªác n√†y?')) {
                work.remove();
                updateStats();
            }
        }

        function addSubWork(workId) {
            subworkCounter++;
            const subworksContainer = document.getElementById(`subworks-${workId}`);
            const subworkNumber = subworksContainer.children.length + 1;
            
            const subworkHtml = `
                <div class="subwork-item" id="subwork-${subworkCounter}">
                    <div class="subwork-header">
                        <div class="subwork-number">${subworkNumber}</div>
                        <input type="text" placeholder="C√¥ng vi·ªác con" style="flex: 1; border: none; background: transparent; font-size: 0.875rem;">
                        <button type="button" class="btn btn-danger btn-sm" style="padding: 0.25rem 0.5rem;" onclick="removeSubWork(${subworkCounter})">üóëÔ∏è</button>
                    </div>
                    <textarea placeholder="M√¥ t·∫£ chi ti·∫øt c√¥ng vi·ªác con..." style="width: 100%; border: 1px solid #e5e7eb; border-radius: 4px; padding: 0.5rem; font-size: 0.8rem; min-height: 60px; resize: vertical;"></textarea>
                </div>
            `;
            
            subworksContainer.insertAdjacentHTML('beforeend', subworkHtml);
            updateStats();
        }

        function removeSubWork(subworkId) {
            const subwork = document.getElementById(`subwork-${subworkId}`);
            if (subwork) {
                subwork.remove();
                updateStats();
            }
        }

        function setupWorkDetails(workId) {
            alert(`M·ªü dialog thi·∫øt l·∫≠p chi ti·∫øt cho c√¥ng vi·ªác ID: ${workId}\n\nT√≠nh nƒÉng s·∫Ω bao g·ªìm:\n- Danh s√°ch v·∫≠t t∆∞, c√¥ng c·ª• c·∫ßn thi·∫øt\n- H∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc chi ti·∫øt\n- L∆∞u √Ω an to√†n\n- ƒêi·ªÅu ki·ªán th·ªùi ti·∫øt\n- Ngu·ªìn l·ª±c c·∫ßn thi·∫øt`);
        }

        function setupEvaluationCriteria(workId) {
            alert(`M·ªü dialog thi·∫øt l·∫≠p ti√™u chu·∫©n ƒë√°nh gi√° cho c√¥ng vi·ªác ID: ${workId}\n\nT√≠nh nƒÉng s·∫Ω bao g·ªìm:\n- Ti√™u ch√≠ ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng\n- Thang ƒëi·ªÉm\n- Ph∆∞∆°ng ph√°p ki·ªÉm tra\n- M·ªëc th·ªùi gian ƒë√°nh gi√°\n- H√†nh ƒë·ªông kh·∫Øc ph·ª•c`);
        }

        function updateStats() {
            const stageCount = document.querySelectorAll('.stage-item').length;
            const workCount = document.querySelectorAll('.work-item').length;
            const subworkCount = document.querySelectorAll('.subwork-item').length;
            
            // Count onetime vs cyclic stages
            let onetimeCount = 0;
            let cyclicCount = 0;
            
            document.querySelectorAll('.stage-item select').forEach(select => {
                if (select.value === 'onetime') onetimeCount++;
                if (select.value === 'cyclic') cyclicCount++;
            });
            
            // Update main stats
            document.getElementById('total-stages').textContent = stageCount;
            document.getElementById('onetime-stages').textContent = onetimeCount;
            document.getElementById('cyclic-stages').textContent = cyclicCount;
            document.getElementById('total-works').textContent = workCount;
            
            // Calculate completion rate
            const requiredFields = ['organization', 'project', 'author', 'production-type', 'specific-object'];
            let filledFields = 0;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim()) {
                    filledFields++;
                }
            });
            
            const completionRate = Math.round(((filledFields / requiredFields.length) * 100));
            document.getElementById('completion-percent').textContent = completionRate + '%';
            
            // Update summary data
            updateSummaryData();
        }

        function updateSummaryData() {
            // Update harvest age
            const harvestAge = document.getElementById('harvest-age');
            document.getElementById('summary-harvest-age').textContent = 
                harvestAge && harvestAge.value ? harvestAge.value : 'Ch∆∞a nh·∫≠p';
            
            // Update growth days
            const growthDays = document.getElementById('growth-days');
            document.getElementById('summary-growth-days').textContent = 
                growthDays && growthDays.value ? growthDays.value : 'Ch∆∞a nh·∫≠p';
            
            // Update density
            const density = document.getElementById('density');
            const densityUnit = density ? density.nextElementSibling.value : '';
            document.getElementById('summary-density').textContent = 
                density && density.value ? `${density.value} ${densityUnit}` : 'Ch∆∞a nh·∫≠p';
            
            // Update yield
            const yieldInput = document.getElementById('yield');
            const yieldUnit = yieldInput ? yieldInput.nextElementSibling.value : '';
            document.getElementById('summary-yield').textContent = 
                yieldInput && yieldInput.value ? `${yieldInput.value} ${yieldUnit}` : 'Ch∆∞a nh·∫≠p';
            
            // Update seasons
            const seasons = document.getElementById('seasons-per-year');
            document.getElementById('summary-seasons').textContent = 
                seasons && seasons.value ? `${seasons.value} v·ª•/nƒÉm` : 'Ch∆∞a nh·∫≠p';
            
            // Update region
            const region = document.getElementById('region');
            document.getElementById('summary-region').textContent = 
                region && region.value ? region.value : 'Ch∆∞a nh·∫≠p';
        }

        function applyStageTemplate(templateName) {
            const templates = {
                'C·∫£i t·∫°o ƒë·∫•t': {
                    name: 'C·∫£i t·∫°o ƒë·∫•t',
                    description: 'X·ª≠ l√Ω v√† chu·∫©n b·ªã ƒë·∫•t tr·ªìng, c·∫£i thi·ªán ƒë·ªô ph√¨ nhi√™u v√† c·∫•u tr√∫c ƒë·∫•t',
                    duration: '15-20 ng√†y',
                    optimalTime: 'Th√°ng 11-12',
                    type: 'onetime',
                    works: [
                        'Ph√¢n t√≠ch ƒë·∫•t v√† ƒë√°nh gi√° pH',
                        'L√†m ƒë·∫•t v√† x·ªõi b·ª´a',
                        'B√≥n v√¥i c·∫£i thi·ªán pH',
                        'B√≥n ph√¢n chu·ªìng hoai m·ª•c'
                    ]
                },
                'Tr·ªìng c√¢y con': {
                    name: 'Tr·ªìng c√¢y con',
                    description: 'Tr·ªìng c√¢y gi·ªëng theo kho·∫£ng c√°ch v√† chƒÉm s√≥c ban ƒë·∫ßu',
                    duration: '7-10 ng√†y',
                    optimalTime: 'ƒê·∫ßu m√πa m∆∞a',
                    type: 'onetime',
                    works: [
                        'ƒê√†o h·ªë tr·ªìng theo kho·∫£ng c√°ch',
                        'Tr·ªìng c√¢y gi·ªëng',
                        'T∆∞·ªõi n∆∞·ªõc sau tr·ªìng',
                        'D·ª±ng c√¢y v√† che ch·∫Øn'
                    ]
                },
                'X·ª≠ l√Ω ra hoa': {
                    name: 'X·ª≠ l√Ω ra hoa',
                    description: 'K√≠ch th√≠ch v√† ƒëi·ªÅu h√≤a qu√° tr√¨nh ra hoa c·ªßa c√¢y tr·ªìng',
                    duration: '30-45 ng√†y',
                    optimalTime: 'Th√°ng 2-3',
                    type: 'cyclic',
                    works: [
                        'C·∫Øt t·ªâa c√†nh v√† l√°',
                        'X·ª≠ l√Ω k√≠ch th√≠ch ra hoa',
                        'B√≥n ph√¢n l√¢n kali',
                        'Theo d√µi v√† ƒë√°nh gi√°'
                    ]
                },
                'X·ª≠ l√Ω s√¢u b·ªánh': {
                    name: 'X·ª≠ l√Ω s√¢u b·ªánh',
                    description: 'Ph√≤ng ng·ª´a v√† ƒëi·ªÅu tr·ªã c√°c lo·∫°i s√¢u b·ªánh h·∫°i',
                    duration: 'Li√™n t·ª•c',
                    optimalTime: 'Quanh nƒÉm',
                    type: 'cyclic',
                    works: [
                        'Quan s√°t v√† ph√°t hi·ªán s√¢u b·ªánh',
                        'X·ª≠ l√Ω b·∫±ng thu·ªëc sinh h·ªçc',
                        'Phun thu·ªëc h√≥a h·ªçc (n·∫øu c·∫ßn)',
                        'D·ªçn d·∫πp v√† x·ª≠ l√Ω c√†nh b·ªánh'
                    ]
                }
            };
            
            const template = templates[templateName];
            if (!template) return;
            
            if (confirm(`√Åp d·ª•ng template "${templateName}"?\nS·∫Ω t·∫°o giai ƒëo·∫°n m·ªõi v·ªõi ${template.works.length} c√¥ng vi·ªác.`)) {
                addStage();
                
                setTimeout(() => {
                    const latestStage = document.querySelector(`#stage-${stageCounter}`);
                    if (latestStage) {
                        // Fill stage info
                        latestStage.querySelector(`#stage-name-${stageCounter}`).value = template.name;
                        latestStage.querySelector('input[placeholder*="15-30 ng√†y"]').value = template.duration;
                        latestStage.querySelector('input[placeholder*="Th√°ng 1-2"]').value = template.optimalTime;
                        latestStage.querySelector('select').value = template.type;
                        latestStage.querySelector('textarea').value = template.description;
                        
                        // Add works
                        template.works.forEach((workName, index) => {
                            addWork(stageCounter);
                            setTimeout(() => {
                                const workInput = document.querySelector(`#work-name-${workCounter}`);
                                if (workInput) workInput.value = workName;
                            }, 100 * (index + 1));
                        });
                    }
                }, 200);
            }
        }

        function applyVarietyParams(variety) {
            const params = {
                'durian-ri6': {
                    growthVariety: 'S·∫ßu ri√™ng Ri6',
                    harvestAge: '7-8 nƒÉm',
                    stableAge: '12-15 nƒÉm',
                    seasons: '1',
                    growthDays: '110-130 ng√†y',
                    density: '100',
                    densityUnit: 'c√¢y/ha',
                    yield: '80-120',
                    yieldUnit: 'kg/c√¢y',
                    ph: '5.5-6.5',
                    temp: '26-30¬∞C',
                    humidity: '75-85%',
                    rainfall: '1800-2500mm',
                    sunlight: '6-8 gi·ªù',
                    altitude: '0-600m'
                },
                'coffee-robusta': {
                    growthVariety: 'C√† ph√™ Robusta',
                    harvestAge: '3-4 nƒÉm',
                    stableAge: '6-8 nƒÉm',
                    seasons: '1',
                    growthDays: '240-270 ng√†y',
                    density: '1600',
                    densityUnit: 'c√¢y/ha',
                    yield: '2.5-4',
                    yieldUnit: 'kg/c√¢y',
                    ph: '5.0-6.0',
                    temp: '22-28¬∞C',
                    humidity: '60-80%',
                    rainfall: '1500-2000mm',
                    sunlight: '4-6 gi·ªù',
                    altitude: '200-800m'
                },
                'passion-fruit': {
                    growthVariety: 'Chanh leo',
                    harvestAge: '8-12 th√°ng',
                    stableAge: '2-3 nƒÉm',
                    seasons: '2',
                    growthDays: '60-80 ng√†y',
                    density: '400',
                    densityUnit: 'c√¢y/ha',
                    yield: '20-30',
                    yieldUnit: 'kg/c√¢y',
                    ph: '6.0-7.0',
                    temp: '23-28¬∞C',
                    humidity: '70-80%',
                    rainfall: '1200-1800mm',
                    sunlight: '6-8 gi·ªù',
                    altitude: '0-1000m'
                },
                'cacao': {
                    growthVariety: 'Cacao Trinitario',
                    harvestAge: '3-5 nƒÉm',
                    stableAge: '8-10 nƒÉm',
                    seasons: '2',
                    growthDays: '150-180 ng√†y',
                    density: '1000',
                    densityUnit: 'c√¢y/ha',
                    yield: '1-2',
                    yieldUnit: 'kg/c√¢y',
                    ph: '6.0-7.0',
                    temp: '24-28¬∞C',
                    humidity: '75-85%',
                    rainfall: '1500-2000mm',
                    sunlight: '3-5 gi·ªù',
                    altitude: '0-300m'
                }
            };
            
            const param = params[variety];
            if (!param) return;
            
            if (confirm(`√Åp d·ª•ng tham s·ªë cho ${param.growthVariety}?\nS·∫Ω ghi ƒë√® c√°c gi√° tr·ªã hi·ªán t·∫°i.`)) {
                // Fill growth parameters
                document.getElementById('growth-variety').value = param.growthVariety;
                document.getElementById('harvest-age').value = param.harvestAge;
                document.getElementById('stable-age').value = param.stableAge;
                document.getElementById('seasons-per-year').value = param.seasons;
                document.getElementById('growth-days').value = param.growthDays;
                document.getElementById('density').value = param.density;
                document.getElementById('density').nextElementSibling.value = param.densityUnit;
                document.getElementById('yield').value = param.yield;
                document.getElementById('yield').nextElementSibling.value = param.yieldUnit;
                
                // Fill environment parameters
                document.getElementById('soil-ph').value = param.ph;
                document.getElementById('temperature').value = param.temp;
                document.getElementById('humidity').value = param.humidity;
                document.getElementById('rainfall').value = param.rainfall;
                document.getElementById('sunlight').value = param.sunlight;
                document.getElementById('altitude').value = param.altitude;
                
                updateStats();
                alert('‚úÖ ƒê√£ √°p d·ª•ng tham s·ªë th√†nh c√¥ng!');
            }
        }

        function saveProcess() {
            const requiredFields = ['organization', 'project', 'author', 'production-type', 'specific-object'];
            const missingFields = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    missingFields.push(field.previousElementSibling.textContent.replace(' *', ''));
                }
            });
            
            if (missingFields.length > 0) {
                alert(`‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc:\n- ${missingFields.join('\n- ')}`);
                return;
            }
            
            if (stageCounter === 0) {
                alert('‚ö†Ô∏è Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt giai ƒëo·∫°n!');
                return;
            }
            
            const workCount = document.querySelectorAll('.work-item').length;
            if (workCount === 0) {
                alert('‚ö†Ô∏è Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt c√¥ng vi·ªác trong c√°c giai ƒëo·∫°n!');
                return;
            }
            
            const stageCount = document.querySelectorAll('.stage-item').length;
            const subworkCount = document.querySelectorAll('.subwork-item').length;
            
            alert(`‚úÖ Quy tr√¨nh ƒë√£ ƒë∆∞·ª£c l∆∞u v√† xu·∫•t b·∫£n th√†nh c√¥ng!\n\nüìä Th·ªëng k√™ quy tr√¨nh:\n- Giai ƒëo·∫°n: ${stageCount}\n- C√¥ng vi·ªác: ${workCount}\n- C√¥ng vi·ªác con: ${subworkCount}\n\nüîó H·ªá th·ªëng s·∫Ω t·∫°o m√£ QR v√† link chia s·∫ª cho ng∆∞·ªùi s·∫£n xu·∫•t\nüìÑ File h∆∞·ªõng d·∫´n s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông`);
        }

        function previewProcess() {
            alert('üîç Ch·ª©c nƒÉng xem tr∆∞·ªõc s·∫Ω hi·ªÉn th·ªã quy tr√¨nh nh∆∞ ng∆∞·ªùi s·∫£n xu·∫•t s·∫Ω th·∫•y');
        }

        function exportProcess() {
            alert('üìÑ ƒêang xu·∫•t file PDF quy tr√¨nh v·ªõi ƒë·ªãnh d·∫°ng khoa h·ªçc...');
        }

        // Initialize on load
        window.onload = function() {
            addStage();
            setTimeout(() => {
                document.getElementById('stage-name-1').value = 'Chu·∫©n b·ªã v√† x·ª≠ l√Ω ƒë·∫•t';
                addWork(1);
                setTimeout(() => {
                    document.getElementById('work-name-1').value = 'L√†m ƒë·∫•t v√† b√≥n ph√¢n c∆° b·∫£n';
                    updateStats();
                }, 100);
            }, 100);
        };

        // Update stats when any input changes
        document.addEventListener('input', updateStats);
        document.addEventListener('change', updateStats);
    </script>
</body>
</html>